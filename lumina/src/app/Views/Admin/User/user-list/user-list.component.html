<div class="bg-white rounded-xl shadow-sm">
    <!-- Header & Filter -->
    <div class="p-6 border-b border-gray-200">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-800">User List</h3>
            <!-- <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center">
        <i class="fas fa-plus mr-2"></i>Add User
      </button> -->
        </div>
        <div class="mt-4 flex items-center space-x-4">
            <div class="flex-1">
                <input type="text" placeholder="Search by name or email..."
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    [(ngModel)]="searchTerm" (ngModelChange)="filterUsers()">
            </div>
            <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                [(ngModel)]="selectedRole" (ngModelChange)="filterUsers()">
                <option>All</option>
                <option *ngFor="let role of roles" [value]="role.name">{{ role.name }}</option>
            </select>
        </div>

    </div>

    <!-- Data Table -->
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Join Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <!-- Loading -->
                <tr *ngIf="isLoading">
                    <td colspan="6" class="text-center py-10 text-gray-500">
                        <i class="fas fa-spinner fa-spin mr-2"></i> Loading data...
                    </td>
                </tr>

                <!-- Error -->
                <tr *ngIf="errorMessage">
                    <td colspan="6" class="text-center py-10 text-red-500">
                        {{ errorMessage }}
                    </td>
                </tr>

                <!-- User Data -->
                <tr *ngFor="let user of filteredUsers" class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <img class="h-10 w-10 rounded-full object-cover"
                                [src]="user.avatarUrl || 'https://ui-avatars.com/api/?name=' + user.fullName"
                                [alt]="user.fullName">
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">{{ user.fullName }}</div>
                                <div class="text-sm text-gray-500">ID: #{{ user.userId }}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ user.email }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full" [ngClass]="{
                    'bg-sky-100 text-sky-800': user.roleId === 1,       
                    'bg-purple-100 text-purple-800': user.roleId === 2, 
                    'bg-amber-100 text-amber-800': user.roleId === 3,   
                    'bg-gray-100 text-gray-800': user.roleId === 4      
                  }">
                            {{ user.roleName }}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <!-- Status based on 'isActive' -->
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full" [ngClass]="{
                    'bg-green-100 text-green-800': user.isActive,
                    'bg-red-100 text-red-800': !user.isActive
                  }">
                            {{ user.isActive ? 'Active' : 'Locked' }}
                        </span>
                    </td>
                    <!-- Date format for readability -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ user.joinDate | date: 'dd/MM/yyyy'
                        }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button class="text-blue-600 hover:text-blue-900 mr-3"
                            [routerLink]="['../user-detail', user.userId]">
                            Details
                        </button>

                        <button class="text-red-600 hover:text-red-900" *ngIf="user.isActive"
                            (click)="toggleStatus(user)">
                            Lock
                        </button>
                        <button class="text-green-600 hover:text-green-900" *ngIf="!user.isActive"
                            (click)="toggleStatus(user)">
                            Unlock
                        </button>
                    </td>

                </tr>

                <!-- No results after loading -->
                <tr *ngIf="!isLoading && filteredUsers.length === 0 && !errorMessage">
                    <td colspan="6" class="text-center py-10 text-gray-500">
                        No users found.
                    </td>
                </tr>
            </tbody>
        </table>
        <!-- Pagination -->
        <div *ngIf="selectedRole === 'All roles'" class="pagination-container flex justify-center mt-4 space-x-1">
            <button (click)="goToPage(pageNumber - 1)" [disabled]="pageNumber === 1"
                class="px-3 py-1 border rounded disabled:opacity-50">Previous</button>

            <button *ngFor="let _ of [].constructor(totalPages); let i = index" (click)="goToPage(i + 1)"
                [class.bg-blue-500]="pageNumber === (i + 1)" [class.text-white]="pageNumber === (i + 1)"
                class="px-3 py-1 border rounded hover:bg-blue-300">
                {{ i + 1 }}
            </button>

            <button (click)="goToPage(pageNumber + 1)" [disabled]="pageNumber === totalPages"
                class="px-3 py-1 border rounded disabled:opacity-50">Next</button>
        </div>

    </div>
</div>