<div class="user-activity-container">
  <!-- Header -->
  <div class="page-header">
    <h1>üìä Ph√¢n T√≠ch Ho·∫°t ƒê·ªông Ng∆∞·ªùi D√πng</h1>
    <button class="btn-refresh" (click)="refreshData()" [disabled]="isLoading">
      <span *ngIf="!isLoading">üîÑ L√†m m·ªõi</span>
      <span *ngIf="isLoading">‚è≥ ƒêang t·∫£i...</span>
    </button>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="errorMessage">
    ‚ö†Ô∏è {{ errorMessage }}
  </div>

  <!-- Loading Spinner -->
  <div class="loading-spinner" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu analytics...</p>
  </div>

  <!-- Main Content -->
  <div class="analytics-content" *ngIf="!isLoading && !errorMessage">
    
    <!-- Key Metrics Cards -->
    <div class="metrics-grid">
      <div class="metric-card realtime">
        <div class="metric-icon">üî¥</div>
        <div class="metric-value">{{ keyMetrics.activeUsersNow }}</div>
        <div class="metric-label">ƒêang Online</div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">üë•</div>
        <div class="metric-value">{{ keyMetrics.totalUsers | number }}</div>
        <div class="metric-label">T·ªïng Ng∆∞·ªùi D√πng (7 ng√†y)</div>
        <div class="metric-sub">{{ keyMetrics.newUsers | number }} m·ªõi</div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">üéØ</div>
        <div class="metric-value">{{ keyMetrics.sessions | number }}</div>
        <div class="metric-label">Phi√™n L√†m Vi·ªác</div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">üìÑ</div>
        <div class="metric-value">{{ keyMetrics.pageViews | number }}</div>
        <div class="metric-label">L∆∞·ª£t Xem Trang</div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">‚è±Ô∏è</div>
        <div class="metric-value">{{ formatDuration(keyMetrics.avgSessionDuration) }}</div>
        <div class="metric-label">Th·ªùi Gian Trung B√¨nh M·ªói Phi√™n</div>
      </div>

      <div class="metric-card">
        <div class="metric-icon">üìä</div>
        <div class="metric-value">{{ keyMetrics.bounceRate | number:'1.1-1' }}%</div>
        <div class="metric-label">T·ª∑ L·ªá Tho√°t</div>
      </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
      
      <!-- Top Pages -->
      <div class="chart-card">
        <h2>üèÜ Trang Ph·ªï Bi·∫øn</h2>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Trang</th>
                <th>L∆∞·ª£t Xem</th>
                <th>Ng∆∞·ªùi D√πng</th>
                <th>Th·ªùi Gian TB</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let page of topPages">
                <td class="page-title">
                  <div class="page-title-text">{{ page.title }}</div>
                  <div class="page-path">{{ page.path }}</div>
                </td>
                <td>{{ page.views | number }}</td>
                <td>{{ page.users | number }}</td>
                <td>{{ formatDuration(page.avgDuration) }}</td>
              </tr>
              <tr *ngIf="topPages.length === 0">
                <td colspan="4" class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Traffic Sources -->
      <!-- <div class="chart-card">
        <h2>Ngu·ªìn L∆∞u L∆∞·ª£ng</h2>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Ngu·ªìn / Lo·∫°i</th>
                <th>Phi√™n L√†m Vi·ªác</th>
                <th>Ng∆∞·ªùi D√πng</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let source of trafficSources">
                <td>
                  <strong>{{ source.source }}</strong>
                  <span class="medium"> / {{ source.medium }}</span>
                </td>
                <td>{{ source.sessions | number }}</td>
                <td>{{ source.users | number }}</td>
              </tr>
              <tr *ngIf="trafficSources.length === 0">
                <td colspan="3" class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div> -->

      <!-- Devices -->
      <!-- <div class="chart-card">
        <h2>Thi·∫øt B·ªã</h2>
        <div class="device-list">
          <div class="device-item" *ngFor="let device of devices">
            <div class="device-info">
              <span class="device-icon">{{ getDeviceIcon(device.device) }}</span>
              <span class="device-name">{{ device.device }}</span>
            </div>
            <div class="device-stats">
              <div class="stat">
                <span class="stat-label">Ng∆∞·ªùi D√πng:</span>
                <span class="stat-value">{{ device.users | number }}</span>
              </div>
              <div class="stat">
                <span class="stat-label">Phi√™n L√†m Vi·ªác:</span>
                <span class="stat-value">{{ device.sessions | number }}</span>
              </div>
            </div>
          </div>
          <div *ngIf="devices.length === 0" class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
        </div>
      </div> -->

      <!-- Countries -->
      <div class="chart-card">
        <h2>üåç Qu·ªëc Gia H√†ng ƒê·∫ßu</h2>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Qu·ªëc Gia / Th√†nh Ph·ªë</th>
                <th>Ng∆∞·ªùi D√πng</th>
                <th>Phi√™n L√†m Vi·ªác</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let country of countries">
                <td>
                  <strong>{{ country.country }}</strong>
                  <span class="city"> - {{ country.city }}</span>
                </td>
                <td>{{ country.users | number }}</td>
                <td>{{ country.sessions | number }}</td>
              </tr>
              <tr *ngIf="countries.length === 0">
                <td colspan="3" class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Daily Traffic -->
      <div class="chart-card full-width">
        <h2>üìà L∆∞u L∆∞·ª£ng H√†ng Ng√†y (7 Ng√†y G·∫ßn Nh·∫•t)</h2>
        <div class="daily-chart">
          <div class="chart-bar" *ngFor="let day of dailyTraffic">
            <div class="bar-wrapper">
              <div class="bar" [style.height.%]="(day.users / getMaxUsers()) * 100">
                <span class="bar-value">{{ day.users }}</span>
              </div>
            </div>
            <div class="bar-label">{{ formatDate(day.date) }}</div>
            <div class="bar-stats">
              <div>Phi√™n: {{ day.sessions }}</div>
              <div>L∆∞·ª£t Xem: {{ day.pageViews }}</div>
            </div>
          </div>
          <div *ngIf="dailyTraffic.length === 0" class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
        </div>
      </div>

      <!-- Browsers -->
      <div class="chart-card">
        <h2>üåê Tr√¨nh Duy·ªát</h2>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Tr√¨nh Duy·ªát</th>
                <th>Ng∆∞·ªùi D√πng</th>
                <th>Phi√™n L√†m Vi·ªác</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let browser of browsers">
                <td>{{ browser.browser }}</td>
                <td>{{ browser.users | number }}</td>
                <td>{{ browser.sessions | number }}</td>
              </tr>
              <tr *ngIf="browsers.length === 0">
                <td colspan="3" class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>
