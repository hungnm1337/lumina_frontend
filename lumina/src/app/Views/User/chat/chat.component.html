<div class="chat-container">


  <!-- Chat Messages -->
  <div class="chat-messages">
    <div *ngFor="let message of messages" class="message" [ngClass]="message.type">
      <!-- Ch·ªâ hi·ªÉn th·ªã content n·∫øu kh√¥ng c√≥ vocabularies (ƒë·ªÉ tr√°nh tr√πng l·∫∑p) -->
      <div *ngIf="!message.vocabularies || message.vocabularies.length === 0" 
           class="message-content" 
           [innerHTML]="formatMessageContent(message.content)">
      </div>
      
      <!-- Hi·ªÉn th·ªã examples n·∫øu c√≥ -->
      <div *ngIf="message.examples && message.examples.length > 0" class="examples">
        <h5>üìù V√≠ d·ª•:</h5>
        <ul>
          <li *ngFor="let example of message.examples">{{ example }}</li>
        </ul>
      </div>
      
      <!-- Hi·ªÉn th·ªã related words n·∫øu c√≥ -->
      <div *ngIf="message.relatedWords && message.relatedWords.length > 0" class="related-words">
        <h5>üîó T·ª´ li√™n quan:</h5>
        <div class="word-tags">
          <span *ngFor="let word of message.relatedWords" class="word-tag">
            {{ word }}
          </span>
        </div>
      </div>

      <!-- Hi·ªÉn th·ªã t·ª´ v·ª±ng ƒë∆∞·ª£c t·∫°o -->
      <div *ngIf="message.vocabularies && message.vocabularies.length > 0" class="vocabulary-list">
        <div class="vocabulary-header">
          <h4>üìö T·ª´ v·ª±ng ƒë∆∞·ª£c t·∫°o</h4>
          <span class="vocab-count">{{ message.vocabularies.length }} t·ª´</span>
        </div>
        
        <div class="vocabulary-grid">
          <div *ngFor="let vocab of message.vocabularies" class="vocabulary-item">
            <!-- Hi·ªÉn th·ªã ·∫£nh cho t·ª´ng t·ª´ v·ª±ng n·∫øu c√≥ -->
            <div *ngIf="vocab.imageUrl" class="vocab-image">
              <img 
                [src]="vocab.imageUrl" 
                [alt]="'Image for ' + vocab.word" 
                loading="lazy"
                (error)="handleImageError($event, vocab)"
                [class.image-error]="vocab.imageError" />
              <div *ngIf="vocab.imageError" class="image-placeholder">
                <i class="fas fa-image"></i>
                <span>Image for {{ vocab.word }}</span>
              </div>
            </div>
            
            <div class="vocab-content">
              <div class="vocab-header">
                <strong class="vocab-word">{{ vocab.word }}</strong> 
                <div class="vocab-badges">
                  <span class="word-type">{{ vocab.typeOfWord }}</span>
                  <span class="category">{{ vocab.category }}</span>
                </div>
              </div>
              <p class="definition">{{ vocab.definition }}</p>
              <div class="example-box">
                <em class="example">{{ vocab.example }}</em>
              </div>
            </div>
          </div>
        </div>
      </div>
      

      <!-- N√∫t l∆∞u t·ª´ v·ª±ng -->
      <div *ngIf="message.hasSaveOption && message.vocabularies && message.vocabularies.length > 0" class="save-actions">
        <button (click)="saveVocabularies(message.vocabularies!)" class="save-btn">
          <i class="fas fa-save"></i>
          <span>L∆∞u v√†o folder</span>
        </button>
      </div>
    </div>

    <!-- Loading indicator -->
    <div *ngIf="isGenerating" class="message ai">
      <div class="typing-indicator">
        <span></span>
        <span></span>
        <span></span>
        AI ƒëang suy nghƒ©...
      </div>
    </div>
  </div>

  <!-- Chat Input -->
  <div class="chat-input">
    <textarea 
      [(ngModel)]="currentMessage" 
      [placeholder]="getPlaceholderText()"
      (keypress)="onKeyPress($event)"
      (input)="onInput($event)"
      [disabled]="isGenerating"
      class="message-input"
      rows="1"
      #messageInput></textarea>
    <button 
      (click)="sendMessage()" 
      [disabled]="isGenerating || !currentMessage.trim()"
      class="send-btn">
      @if (isGenerating) {
        <i class="fas fa-spinner fa-spin"></i>
      } @else {
        <i class="fas fa-paper-plane"></i>
      }
    </button>
  </div>
</div>
