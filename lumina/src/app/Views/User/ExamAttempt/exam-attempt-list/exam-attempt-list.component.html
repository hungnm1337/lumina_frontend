<div class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50">
  <div class="max-w-7xl mx-auto p-4 md:p-8 space-y-8">
    <!-- Header -->
    <div
      class="relative overflow-hidden bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 rounded-2xl shadow-2xl p-8">
      <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-10 rounded-full -mr-32 -mt-32"></div>
      <div class="absolute bottom-0 left-0 w-48 h-48 bg-white opacity-10 rounded-full -ml-24 -mb-24"></div>
      <div class="relative z-10">
        <h1 class="text-4xl md:text-5xl font-extrabold mb-3 text-white drop-shadow-lg">
          Lịch sử làm bài
        </h1>
        <p class="text-blue-100 text-lg">Theo dõi tiến độ học tập và xem lại các lần làm bài của bạn</p>
      </div>
    </div>

    <!-- Statistics Cards -->
    @if (!isLoading) {
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Total Attempts Card -->
      <div
        class="group bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 p-6 border-t-4 border-blue-500 transform hover:-translate-y-1">
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Tổng số lượt thi</div>
            <div class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-blue-400 bg-clip-text text-transparent">
              {{ getTotalAttempts() }}
            </div>
          </div>
        </div>
      </div>

      <!-- Filtered Count Card -->
      <div
        class="group bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 p-6 border-t-4 border-green-500 transform hover:-translate-y-1">
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Đang hiển thị</div>
            <div class="text-4xl font-bold bg-gradient-to-r from-green-600 to-green-400 bg-clip-text text-transparent">
              {{ getFilteredCount() }}
            </div>
          </div>
        </div>
      </div>

      <!-- Average Score Card -->
      <div
        class="group bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 p-6 border-t-4 border-purple-500 transform hover:-translate-y-1">
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Điểm trung bình</div>
            <div
              class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-purple-400 bg-clip-text text-transparent">
              {{ getAverageScore() }}
            </div>
          </div>
        </div>
      </div>
    </div>
    }

    <!-- Filter and Sort Panel -->
    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
      <div class="flex flex-wrap items-center gap-4 mb-4">
        <!-- Search -->
        <div class="flex-1 min-w-[250px] relative">
          <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
            placeholder="Tìm kiếm theo tên bài thi, phần thi hoặc người dùng..."
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
        </div>

        <!-- Status Filter -->
        <div class="min-w-[200px]">
          <label class="block text-xs font-semibold text-gray-600 mb-1.5 ml-1">Trạng thái</label>
          <select [(ngModel)]="filterStatus" (ngModelChange)="onFilterChange()"
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all cursor-pointer hover:border-gray-300 font-medium text-gray-700">
            <option value="all">Tất cả</option>
            <option value="Completed">Đã hoàn thành</option>
            <option value="Doing">Đang làm</option>
          </select>
        </div>

        <!-- Sort -->
        <div class="min-w-[200px]">
          <label class="block text-xs font-semibold text-gray-600 mb-1.5 ml-1">Sắp xếp theo</label>
          <select [(ngModel)]="sortBy" (ngModelChange)="onSortChange()"
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all cursor-pointer hover:border-gray-300 font-medium text-gray-700">
            <option value="dateDesc">Mới nhất</option>
            <option value="dateAsc">Cũ nhất</option>
            <option value="scoreDesc">Điểm cao nhất</option>
            <option value="scoreAsc">Điểm thấp nhất</option>
            <option value="examName">Tên bài thi (A-Z)</option>
          </select>
        </div>

        <!-- Reset Button -->
        <button (click)="resetFilters()"
          class="px-6 py-3 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-xl hover:from-gray-200 hover:to-gray-300 transition-all font-medium shadow-sm hover:shadow-md transform hover:scale-105">
          Đặt lại
        </button>
      </div>
    </div>

    <!-- Loading State -->
    @if (isLoading) {
    <div class="bg-white rounded-xl shadow-lg p-12 text-center">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
      <p class="text-gray-600">Đang tải dữ liệu...</p>
    </div>
    }

    <!-- Empty State -->
    @if (!isLoading && filteredAttempts.length === 0) {
    <div class="bg-white rounded-xl shadow-lg p-12 text-center">
      <h3 class="text-xl font-semibold text-gray-800 mb-2">Không tìm thấy lịch sử làm bài</h3>
      <p class="text-gray-500">Thử thay đổi bộ lọc hoặc từ khóa tìm kiếm</p>
    </div>
    }

    <!-- Exam Attempts List -->
    @if (!isLoading && filteredAttempts.length > 0) {
    <div class="space-y-4">
      @for (attempt of filteredAttempts; track attempt.attemptID) {
      <div (click)="viewDetail(attempt.attemptID)"
        class="bg-white rounded-xl shadow-md hover:shadow-2xl transition-all duration-300 p-6 cursor-pointer border-2 border-transparent hover:border-blue-400 group transform hover:-translate-y-1">

        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <!-- Left Section -->
          <div class="flex-1 space-y-3">
            <div class="flex items-start gap-4">
              <div
                class="flex-shrink-0 w-14 h-14 bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-600 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg group-hover:scale-110 transition-transform">
                {{ attempt.attemptID }}
              </div>
              <div class="flex-1">

                <p class="text-sm text-gray-600 font-medium">
                  @if (attempt.examPartName=== null||attempt.examPartName=== "") {
                <h3 class="text-xl font-bold text-gray-800 group-hover:text-blue-600 transition-colors mb-1">
                  Mocktest
                </h3>
                } @else {
                <h3 class="text-xl font-bold text-gray-800 group-hover:text-blue-600 transition-colors mb-1">
                  {{ attempt.examName }}
                </h3>
                {{ attempt.examPartName }}
                }
                </p>
              </div>
            </div>

            <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600">
              <div class="flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg">
                <span class="font-medium">{{ formatDate(attempt.startTime) }}</span>
              </div>
              @if (attempt.endTime) {
              <div class="flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg">
                <span class="font-medium">{{ formatDuration(attempt.startTime, attempt.endTime) }}</span>
              </div>
              }
              <div class="flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg">
                <span class="font-medium">{{ attempt.userName }}</span>
              </div>
            </div>
          </div>

          <!-- Right Section -->
          <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
            <!-- Status Badge -->
            <div class="px-5 py-2.5 rounded-full text-sm font-bold shadow-sm"
              [ngClass]="getStatusClass(attempt.status)">
              {{ attempt.status }}
            </div>

            <!-- Score -->
            @if (attempt.score !== null) {
            <div class="text-right bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 min-w-[100px]">
              <div class="text-xs text-gray-500 mb-1 font-semibold uppercase tracking-wide">Điểm</div>
              <div class="text-3xl font-bold" [ngClass]="{
              'text-green-600': attempt.score >= 70,
              'text-yellow-600': attempt.score >= 50 && attempt.score < 70,
              'text-red-600': attempt.score < 50
            }">
                {{ attempt.score }}
              </div>
            </div>
            } @else {
            <div class="text-sm text-gray-400 italic bg-gray-50 px-4 py-2 rounded-lg">Chưa có điểm</div>
            }

            <!-- View Detail Arrow -->
            <div class="text-blue-600 text-2xl group-hover:translate-x-2 transition-transform duration-300">
              →
            </div>
          </div>
        </div>
      </div>
      }
    </div>
    }
  </div>
</div>
