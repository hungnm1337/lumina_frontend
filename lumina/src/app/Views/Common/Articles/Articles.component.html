<app-header></app-header>

<!-- Blog Hero Section -->
<div class="blog-hero">
  <div class="hero-content">
    <h1 class="hero-title">Bài viết TOEIC</h1>
    <p class="hero-subtitle">Khám phá kiến thức, mẹo học tập và kinh nghiệm thi TOEIC từ các chuyên gia hàng đầu</p>
  </div>
</div>

<!-- Search Section -->
<div class="search-filter-section">
  <div class="search-container">
    <div class="search-input-group">
      <input
        type="text"
        [(ngModel)]="searchQuery"
        placeholder="Tìm kiếm bài viết..."
        class="search-input"
        (keyup.enter)="onSearch()"
      >
      <button class="search-btn" (click)="onSearch()">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </div>
</div>

<!-- Featured Articles Section -->
<div class="featured-section">
  <div class="section-header">
    <h2 class="section-title">Bài viết nổi bật</h2>
    <p class="section-subtitle">Các bài viết được đọc và chia sẻ nhiều nhất</p>
  </div>

  <div class="articles-grid featured-grid" *ngIf="!isLoading">
    <div *ngFor="let article of featuredArticles" class="article-card featured-card" (click)="goToArticleDetail(article.articleId)">
      <div class="card-header">
        <div class="card-tags">
          <span class="tag featured-tag">Nổi bật</span>
          <span [class]="getStatusBadgeClass(getArticleProgress(article.articleId).status)">
            {{ getStatusText(getArticleProgress(article.articleId).status) }}
          </span>
        </div>
      </div>

      <!-- Completion icon -->
      <div class="completion-icon" *ngIf="getArticleProgress(article.articleId).status === 'completed'">

      </div>

      <div class="card-image">
        <div class="image-placeholder" [style.background-color]="getCardBackgroundColor(article.articleId)">
          {{ article.title.substring(0, 20) }}
        </div>
      </div>

      <div class="card-content">
        <div class="card-meta">
          <span [class]="'category-tag ' + getCategoryColor(article.categoryName)">{{ article.categoryName }}</span>
          <span class="read-time">{{ getReadTime(article.summary) }}</span>
        </div>

        <h3 class="card-title">{{ article.title }}</h3>
        <p class="card-summary">{{ article.summary }}</p>

        <div class="card-author">
          <div [class]="'author-avatar ' + getAuthorAvatarColor(0)">
            {{ article.authorName.charAt(0).toUpperCase() }}
          </div>
          <div class="author-info">
            <span class="author-name">{{ article.authorName }}</span>
            <span class="publish-date">{{ formatDate(article.createdAt) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Đang tải bài viết...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <p>{{ error }}</p>
    <button (click)="loadPublishedArticles()" class="retry-btn">Thử lại</button>
  </div>
</div>

<!-- Latest Articles Section -->
<div class="latest-section">
  <div class="section-header">
    <h2 class="section-title">
      <span *ngIf="selectedAuthor">Bài viết của {{ selectedAuthor }}</span>
      <span *ngIf="!selectedAuthor">Bài viết mới nhất</span>
    </h2>
    <p class="section-subtitle" *ngIf="!selectedAuthor">Cập nhật kiến thức TOEIC mới nhất</p>
    <button
      *ngIf="selectedAuthor"
      (click)="clearAuthorFilter()"
      class="clear-filter-btn">
      <i class="fas fa-times"></i>
      Xóa bộ lọc
    </button>
    <button
      class="view-more-btn"
      (click)="onViewMoreLatestArticles()"
      *ngIf="hasMoreArticles"
    >
      {{ showAllLatestArticles ? 'Thu gọn' : '+ Xem thêm' }}
    </button>
  </div>

  <div class="articles-grid latest-grid" *ngIf="!isLoading">
    <div *ngFor="let article of latestArticles" class="article-card latest-card" (click)="goToArticleDetail(article.articleId)">
      <div class="card-header">
        <div class="card-tags">
          <span class="tag trending-tag">Mới</span>
          <span [class]="getStatusBadgeClass(getArticleProgress(article.articleId).status)">
            {{ getStatusText(getArticleProgress(article.articleId).status) }}
          </span>
        </div>
      </div>

      <!-- Completion icon -->
      <div class="completion-icon" *ngIf="getArticleProgress(article.articleId).status === 'completed'">

      </div>

      <div class="card-image">
        <div class="image-placeholder" [style.background-color]="getCardBackgroundColor(article.articleId)">
          {{ article.title.substring(0, 20) }}
        </div>
      </div>

      <div class="card-content">
        <div class="card-meta">
          <span [class]="'category-tag ' + getCategoryColor(article.categoryName)">{{ article.categoryName }}</span>
          <span class="read-time">{{ getReadTime(article.summary) }}</span>
        </div>

        <h3 class="card-title">{{ article.title }}</h3>
        <p class="card-summary">{{ article.summary }}</p>

        <div class="card-author">
          <div [class]="'author-avatar ' + getAuthorAvatarColor(0)">
            {{ article.authorName.charAt(0).toUpperCase() }}
          </div>
          <div class="author-info">
            <span class="author-name">{{ article.authorName }}</span>
            <span class="publish-date">{{ formatDate(article.createdAt) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="showAllLatestArticles && totalPages > 1 && !isLoading">
    <div class="pagination">
      <button
        class="pagination-btn prev-btn"
        (click)="previousPage()"
        [disabled]="currentPage === 1"
        [class.disabled]="currentPage === 1"
      >
        <i class="fas fa-chevron-left"></i>
        <span>Trước</span>
      </button>

      <div class="pagination-numbers">
        <button
          *ngIf="currentPage > 3"
          class="pagination-number"
          (click)="goToPage(1)"
        >
          1
        </button>
        <span *ngIf="currentPage > 4" class="pagination-ellipsis">...</span>

        <button
          *ngFor="let page of getPageNumbers()"
          class="pagination-number"
          [class.active]="currentPage === page"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>

        <span *ngIf="currentPage < totalPages - 3" class="pagination-ellipsis">...</span>
        <button
          *ngIf="currentPage < totalPages - 2"
          class="pagination-number"
          (click)="goToPage(totalPages)"
        >
          {{ totalPages }}
        </button>
      </div>

      <button
        class="pagination-btn next-btn"
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
        [class.disabled]="currentPage === totalPages"
      >
        <span>Tiếp</span>
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>

    <div class="pagination-info">
      Trang {{ currentPage }} / {{ totalPages }} ({{ publishedArticles.length }} bài viết)
    </div>
  </div>
</div>

<!-- Featured Authors Section -->
<div class="authors-section">
  <div class="section-header">
    <h2 class="section-title">Tác giả nổi bật</h2>
    <p class="section-subtitle">Chuyên gia TOEIC hàng đầu</p>
  </div>

  <div class="authors-grid">
    <div
      *ngFor="let author of featuredAuthors"
      class="author-card"
      [class.active]="selectedAuthor === author.name"
      (click)="filterByAuthor(author.name)">
      <div [class]="'author-avatar ' + author.avatarColor">
        {{ author.avatar }}
      </div>
      <h3 class="author-name">{{ author.name }}</h3>
      <p class="author-expertise">{{ author.expertise }}</p>
      <div class="author-stats">
        <span class="articles-count">{{ author.articlesCount }} bài viết</span>
      </div>
    </div>
  </div>
</div>




