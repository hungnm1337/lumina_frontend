<app-header></app-header>

<!-- Back to Blog Link -->
<div class="back-to-blog">
  <button (click)="goBackToBlog()" class="back-btn">
    <i class="fas fa-arrow-left"></i>
    Back to articles
  </button>
</div>

<!-- Article Content -->
<div class="article-container" *ngIf="!isLoading && article">
  <div class="article-content">
    <!-- Article Metadata -->
    <div class="article-meta">
      <span [class]="'category-tag ' + getCategoryColor(article.categoryName)">{{ article.categoryName }}</span>
      <span class="publish-date">{{ formatDate(article.createdAt) }}</span>
      <span class="read-time">{{ getReadTime(article.summary) }}</span>
      <!-- Completion Indicator -->
      <span class="completion-indicator" *ngIf="articleProgress && articleProgress.status === 'completed'">
        <i class="fas fa-check-circle"></i>
        Completed
      </span>
      <span class="progress-indicator" *ngIf="articleProgress && articleProgress.status === 'in_progress'">
        <i class="fas fa-clock"></i>
        {{ articleProgress.progressPercent }}% read
      </span>
    </div>

    <!-- Article Title -->
    <h1 class="article-title">{{ article.title }}</h1>

    <!-- Author Info -->
    <div class="author-section">
      <div class="author-info">
        <div [class]="'author-avatar ' + getAuthorAvatarColor(article.authorName)">
          {{ article.authorName.charAt(0).toUpperCase() }}
        </div>
        <div class="author-details">
          <h3 class="author-name">{{ article.authorName }}</h3>
          <p class="author-title">Content Creator</p>
        </div>
      </div>
      <div class="article-actions">
        <button class="action-btn like-btn" (click)="onLikeArticle()">
          <i class="fas fa-heart"></i>
          {{ articleLikes }}
        </button>
        <button class="action-btn share-btn" (click)="onShareArticle()">
          <i class="fas fa-bookmark"></i>
          Share article
        </button>
      </div>
    </div>

    <!-- Article Introduction -->
    <div class="article-intro">
      <p>{{ article.summary }}</p>
    </div>

    <!-- Article Content Sections (chỉ hiển thị 1 section tại một thời điểm - giống exam) -->
    <div class="content-sections">
      <div *ngIf="article.sections && article.sections.length > 0; else noContent">
        <!-- Chỉ hiển thị section hiện tại -->
        <div *ngIf="article.sections[currentSectionIndex]" 
             class="content-section"
             [class.active]="true"
             [class.completed]="isSectionCompleted(currentSectionIndex)">
          
          <!-- Section Header -->
          <div class="section-header">
            <h2 class="section-title">
              Section {{ currentSectionIndex + 1 }} / {{ article.sections.length }}: 
              {{ article.sections[currentSectionIndex].sectionTitle }}
            </h2>
            <div class="section-status" *ngIf="isSectionCompleted(currentSectionIndex)">
              <i class="fas fa-check-circle"></i>
              <span>Completed</span>
            </div>
          </div>
          
          <!-- Section Content -->
          <div class="section-content" 
               [innerHTML]="article.sections[currentSectionIndex].sectionContent">
          </div>
          
          <!-- Mark as Read Button -->
          <div class="section-actions" *ngIf="!isSectionCompleted(currentSectionIndex)">
            <button class="mark-read-btn" (click)="markSectionAsRead(currentSectionIndex)">
              <i class="fas fa-check"></i>
              Mark as Read
            </button>
          </div>
        </div>

        <!-- Navigation Buttons (giống exam - Previous/Next) -->
        <div class="section-navigation">
          <button
            (click)="previousSection()"
            [disabled]="currentSectionIndex === 0"
            class="nav-btn prev-btn">
            <i class="fas fa-arrow-left"></i>
            Previous Section
          </button>

          <button
            (click)="nextSection()"
            [disabled]="currentSectionIndex === article.sections.length - 1"
            class="nav-btn next-btn">
            Next Section
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>

        <!-- Section Navigator (giống exam question navigator) - Hiển thị dưới navigation buttons -->
        <div class="section-navigator" *ngIf="article && article.sections && article.sections.length > 0">
          <div class="navigator-container">
            <h4 class="navigator-title">Navigator</h4>
            <div class="section-buttons grid-cols-10">
              <button 
                *ngFor="let section of article.sections; let i = index"
                [class]="'section-btn ' + getSectionButtonClass(i)"
                (click)="goToSection(i)"
                [disabled]="!canAccessSection(i)">
                {{ i + 1 }}
              </button>
            </div>
          </div>
        </div>
      </div>
      <ng-template #noContent>
        <div class="no-content">
          <p>Article content is being updated...</p>
        </div>
      </ng-template>
    </div>

    <!-- Tags -->
    <div class="article-tags">
      <span class="tag">{{ article.categoryName }}</span>
    </div>

    <!-- Share Buttons -->
    <div class="share-section">
      <h4 class="share-title">Share article</h4>
      <div class="share-buttons">
        <button class="share-btn facebook">
          <i class="fab fa-facebook-f"></i>
        </button>
        <button class="share-btn twitter">
          <i class="fab fa-twitter"></i>
        </button>
        <button class="share-btn linkedin">
          <i class="fab fa-linkedin-in"></i>
        </button>
        <button class="share-btn other">
          <i class="fas fa-share-alt"></i>
        </button>
      </div>
    </div>

    <!-- Author Bio -->
    <div class="author-bio">
      <div class="author-bio-header">
        <div [class]="'author-avatar ' + getAuthorAvatarColor(article.authorName)">
          {{ article.authorName.charAt(0).toUpperCase() }}
        </div>
        <div class="author-bio-info">
          <h3 class="author-name">{{ article.authorName }}</h3>
          <p class="author-bio-text">Professional Content Creator with years of experience in TOEIC education.</p>
          <div class="author-stats">
            <span class="stat">1 article</span>
            <span class="stat">0 followers</span>
            <span class="stat">0 likes</span>
          </div>
        </div>
        <button
          [class]="isFollowing ? 'follow-btn following' : 'follow-btn'"
          (click)="onFollowAuthor()"
        >
          {{ isFollowing ? 'Following' : '+ Follow' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="isLoading" class="loading-state">
  <div class="loading-spinner"></div>
    <p>Loading article...</p>
</div>

<!-- Error State -->
<div *ngIf="error" class="error-state">
  <p>{{ error }}</p>
    <button (click)="loadArticle()" class="retry-btn">Retry</button>
</div>

<!-- Floating Chat Box - Always visible at bottom right -->
@if(isLogin){
<app-chat-box [contentArticle]="contentArticle"></app-chat-box>
<app-note *ngIf="article" [articleId]="article.articleId"></app-note>
}
