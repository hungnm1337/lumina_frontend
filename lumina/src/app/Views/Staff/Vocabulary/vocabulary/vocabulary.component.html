
<div class="vocabulary-container">
  <div *ngIf="currentView === 'lists'">

    <div class="page-header">
      <div class="header-content">
        <div class="title-section">
          <h1 class="page-title">
            <i class="fas fa-graduation-cap"></i>
            <span class="toeic-badge">TOEIC</span> 
            Vocabulary Management
          </h1>
          <p class="page-subtitle">
            <i class="fas fa-book-open"></i>
            Organize your vocabulary into lists for focused learning
          </p>
        </div>
      </div>
      <button class="btn-primary" (click)="openCreateListModal()"><i class="fas fa-folder-plus"></i> Add New List</button>
    </div>

    <div class="search-filter-panel">
      <div class="search-section">
        <div class="search-input-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()" placeholder="Search vocabulary lists..." class="search-input">
          <button *ngIf="searchTerm" (click)="clearSearch()" class="clear-search-btn"><i class="fas fa-times"></i></button>
        </div>
      </div>
    </div>


    <div *ngIf="isLoading" class="loading-state">
      <div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div><p>Loading lists...</p>
    </div>
    <div *ngIf="!isLoading && vocabularyLists.length > 0" class="folder-grid">
      <div *ngFor="let list of vocabularyLists" class="folder-card" (click)="selectList(list)">
        <div class="folder-icon"><i class="fas fa-folder"></i></div>
        <div class="folder-details">
          <h3 class="folder-name">{{ list.name }}</h3>
          <p class="folder-meta">{{ list.vocabularyCount }} words Â· Created by {{ list.makeByName }}</p>
          <div class="status-section">
            <span class="status-badge" [ngClass]="getStatusClass(list.status)">
              {{ getStatusText(list.status) }}
            </span>
            <span *ngIf="list.rejectionReason" class="rejection-reason">
              <i class="fas fa-exclamation-triangle"></i> {{ list.rejectionReason }}
            </span>
          </div>
        </div>
        <div class="folder-actions">
          <div *ngIf="list.status?.toLowerCase() === 'draft' || list.status?.toLowerCase() === 'rejected'" class="action-buttons">
            <button class="btn-request-approval" (click)="requestApproval(list, $event)" 
                    [disabled]="isSubmitting">
              <i class="fas fa-paper-plane"></i> 
              <span *ngIf="!isSubmitting">Send for Review</span>
              <span *ngIf="isSubmitting">Sending...</span>
            </button>
          </div>
          <div *ngIf="list.status?.toLowerCase() === 'pending'" class="status-info status-pending">
            <i class="fas fa-clock"></i>
            <span>Waiting for approval</span>
          </div>
          <div *ngIf="list.status?.toLowerCase() === 'published'" class="status-info status-published">
            <i class="fas fa-check-circle"></i>
            <span>Approved & Published</span>
          </div>
          <div class="folder-arrow"><i class="fas fa-chevron-right"></i></div>
        </div>
      </div>
    </div>
    <div *ngIf="!isLoading && vocabularyLists.length === 0" class="empty-state">
      <div class="empty-icon"><i class="fas fa-folder-open"></i></div>
      <h3>No vocabulary lists found</h3>
      <p>Create your first list to start adding words. Remember to send for review when ready!</p>
      <button class="btn-add-first" (click)="openCreateListModal()"><i class="fas fa-plus"></i> Create First List</button>
    </div>
  </div>
  <div *ngIf="currentView === 'words' && selectedList">
    <div class="page-header">
      <div class="header-content">
        <button class="btn-back" (click)="showListView()"><i class="fas fa-arrow-left"></i> Back to Lists</button>
        <div class="title-section">
          <h1 class="page-title">
            <i class="fas fa-folder-open folder-title-icon"></i> 
            {{ selectedList.name }}
            <span class="word-count-badge">{{ selectedList.vocabularyCount }} words</span>
          </h1>
          <p class="page-subtitle">
            <i class="fas fa-cogs"></i>
            Manage all words inside this list
          </p>
        </div>
      </div>
      <button class="btn-primary" (click)="openModal()"><i class="fas fa-plus"></i> Add New Word</button>
    </div>

    <div class="search-filter-panel">
      <div class="search-section">
        <div class="search-input-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()" placeholder="Search words in this list..." class="search-input">
          <button *ngIf="searchTerm" (click)="clearSearch()" class="clear-search-btn"><i class="fas fa-times"></i></button>
        </div>
      </div>
    </div>
    

    <div class="main-content">
      <div class="vocabulary-list-section">
        <div *ngIf="isLoading" class="loading-state">
          <div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div><p>Loading vocabulary...</p>
        </div>
        <div *ngIf="!isLoading" class="vocabulary-grid">
          <div *ngFor="let vocab of pagedVocabularies" class="vocabulary-card">
            <div class="card-header">
              <div class="word-section">
                <h3 class="word-title" (click)="speakWord(vocab.word)">{{vocab.word}} <i class="fas fa-volume-up speak-icon"></i></h3>
                <div class="pronunciation" *ngIf="vocab.pronunciation">{{vocab.pronunciation}}</div>
              </div>
              <div class="card-actions">
                <span class="category-badge"><i class="fas fa-tag"></i> {{getCategoryName(vocab.category)}}</span>
                <div class="action-buttons">
                  <button class="btn-action btn-study" title="Study with flashcards"><i class="fas fa-brain"></i></button>
                  <button class="btn-action btn-quiz" title="Take quiz"><i class="fas fa-question-circle"></i></button>
                  <button class="btn-action btn-edit" (click)="openModal(vocab)" title="Edit word"><i class="fas fa-edit"></i></button>
                  <button class="btn-action btn-delete" (click)="deleteVocabulary(vocab.id)" title="Delete word"><i class="fas fa-trash"></i></button>
                </div>
              </div>
            </div>
            <div class="card-content">
              <div class="word-meta">
                <span class="pos-tag">{{vocab.partOfSpeech}}</span>
                <span class="translation">{{vocab.translation}}</span>
              </div>
              <p class="definition-text">{{vocab.definition}}</p>
              <p class="example-text" *ngIf="vocab.example">"{{vocab.example}}"</p>
            </div>
          </div>
        </div>
        
        <div *ngIf="!isLoading && pagedVocabularies.length === 0" class="empty-state">
          <div class="empty-icon"><i class="fas fa-box-open"></i></div><h3>This list is empty</h3><p>Start by adding the first vocabulary word to this list.</p>
          <button class="btn-add-first" (click)="openModal()"><i class="fas fa-plus"></i> Add First Word</button>
        </div>
        <div *ngIf="!isLoading && totalPages > 1" class="pagination-section">
          <div class="pagination-info">
            <div class="pagination-stats">
              <i class="fas fa-info-circle"></i>
              <span>Showing {{getStartIndex()}} - {{getEndIndex()}} of {{totalItems}} words</span>
            </div>
            <div class="pagination-page-info">
              <span class="page-indicator">Page {{page}} of {{totalPages}}</span>
            </div>
          </div>
          <div class="pagination-controls">
            <button class="btn-page btn-prev" [disabled]="page <= 1" (click)="prevPage()">
              <i class="fas fa-chevron-left"></i>
              <span>Previous</span>
            </button>
            <div class="page-numbers">
              <button *ngFor="let pageNum of getPageNumbers()" 
                      class="page-number" 
                      [class.active]="pageNum === page"
                      (click)="goToPage(pageNum)">
                {{pageNum}}
              </button>
            </div>
            <button class="btn-page btn-next" [disabled]="page >= totalPages" (click)="nextPage()">
              <span>Next</span>
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
<div *ngIf="isListModalOpen" class="modal-overlay" (click)="closeCreateListModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-header-content">
        <div class="modal-icon"><i class="fas fa-folder-plus"></i></div>
        <div class="modal-title-section">
          <h2>Create New Vocabulary List</h2>
          <p>Start a new collection of words</p>
        </div>
      </div>
      <button class="btn-close" (click)="closeCreateListModal()"><i class="fas fa-times"></i></button>
    </div>
    <form [formGroup]="listForm" (ngSubmit)="saveNewList()" class="modal-form">
      <div class="form-group">
        <label for="list-name">List Name *</label>
        <input id="list-name" type="text" formControlName="name" placeholder="e.g., TOEIC Business Vocabulary" class="form-input">
        <div *ngIf="listForm.get('name')?.invalid && listForm.get('name')?.touched" class="error-message">
          List name is required.
        </div>
      </div>
      <div class="form-group">
        <div class="checkbox-wrapper">
          <input id="isPublic" type="checkbox" formControlName="isPublic" class="form-checkbox">
          <label for="isPublic">Make this list public for all users</label>
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeCreateListModal()">Cancel</button>
        <button type="submit" class="btn-primary" [disabled]="listForm.invalid || isSubmitting">
          <i *ngIf="isSubmitting" class="fas fa-spinner fa-spin"></i>
          Create List
        </button>
      </div>
    </form>
  </div>
</div>
<div *ngIf="isModalOpen" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content vocabulary-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-header-content">
        <div class="modal-icon">
          <i class="fas fa-book-medical"></i>
        </div>
        <div class="modal-title-section">
          <h2>{{ editingVocabulary ? 'Edit Vocabulary' : 'Add New Vocabulary' }}</h2>
          <p>Build your TOEIC vocabulary collection</p>
        </div>
      </div>
      <button class="btn-close" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form [formGroup]="vocabularyForm" (ngSubmit)="saveVocabulary()" class="modal-form">
  
      <div class="form-group full-width">
        <label for="word">ENGLISH WORD <span class="required">*</span></label>
        <input
          id="word"
          type="text"
          formControlName="word"
          class="form-input"
          placeholder="Enter English word"
        />
        <div *ngIf="vocabularyForm.get('word')?.invalid && vocabularyForm.get('word')?.touched" class="error-message">
          English word is required.
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="partOfSpeech">PART OF SPEECH <span class="required">*</span></label>
          <select id="partOfSpeech" formControlName="partOfSpeech" class="form-select">
            <option value="">Select part of speech</option>
            <option *ngFor="let pos of partsOfSpeech" [value]="pos">{{ pos }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="category">CATEGORY <span class="required">*</span></label>
          <select id="category" formControlName="category" class="form-select">
            <option value="">Select category</option>
            <option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</option>
          </select>
        </div>

      </div>

      <!-- Definition -->
      <div class="form-group full-width">
        <label for="definition">DEFINITION <span class="required">*</span></label>
        <textarea
          id="definition"
          formControlName="definition"
          rows="3"
          class="form-textarea"
          placeholder="Enter word definition"
        ></textarea>
      </div>

      <!-- Vietnamese Translation -->
      <div class="form-group full-width">
        <label for="translation">VIETNAMESE TRANSLATION <span class="required">*</span></label>
        <textarea
          id="translation"
          formControlName="translation"
          rows="2"
          class="form-textarea"
          placeholder="Enter Vietnamese translation"
        ></textarea>
      </div>

      <!-- Example Sentence -->
      <div class="form-group full-width">
        <label for="example">EXAMPLE SENTENCE <span class="required">*</span></label>
        <textarea
          id="example"
          formControlName="example"
          rows="3"
          class="form-textarea"
          placeholder="Enter example sentence"
        ></textarea>
      </div>

      <!-- Actions -->
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeModal()">
          Cancel
        </button>
        <button type="submit" class="btn-primary" [disabled]="vocabularyForm.invalid || isSubmitting">
          <i *ngIf="isSubmitting" class="fas fa-spinner fa-spin"></i>
          {{ editingVocabulary ? 'Update Word' : 'Add Word' }}
        </button>
      </div>
    </form>
  </div>
</div>
