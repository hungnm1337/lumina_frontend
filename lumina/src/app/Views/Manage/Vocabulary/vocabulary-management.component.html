<div class="vocabulary-management-container">
  <!-- TOEIC Header Section - MANAGER VERSION -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <span class="toeic-badge">TOEIC</span>
          Vocabulary Management
        </h1>
        <p class="page-subtitle">
          Review and manage vocabulary lists from staff
        </p>
      </div>
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-number">{{getTotalCount() || 0}}</div>
          <div class="stat-label">Total Lists</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{getPendingCount()}}</div>
          <div class="stat-label">Pending</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{getPublishedCount()}}</div>
          <div class="stat-label">Published</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Advanced Search & Filter Panel -->
  <div class="search-filter-panel">
    <div class="search-section">
      <div class="search-input-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchInput($event)"
          placeholder="Search vocabulary lists..."
          class="search-input"
          maxlength="100">
        <button 
          *ngIf="searchTerm" 
          (click)="clearSearch()" 
          class="clear-search-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <div class="filters-section">
      <div class="filter-group">
        <label>Status</label>
        <select [(ngModel)]="statusFilter" (change)="onStatusFilterChange()" class="filter-select">
          <option value="all">All Status</option>
          <option value="pending">Pending</option>
          <option value="published">Published</option>
          <option value="rejected">Rejected</option>
        </select>
      </div>

      <div class="filter-actions">
        <button (click)="statusFilter = 'all'; onStatusFilterChange()" class="btn-clear-filters">
          <i class="fas fa-eraser"></i>
          Clear All
        </button>
        <button (click)="loadVocabularyLists()" class="btn-refresh">
          <i class="fas fa-sync-alt"></i>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Vocabulary Lists Section -->
    <div class="lists-list-section">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
        <p>Loading vocabulary lists...</p>
      </div>

      <!-- Vocabulary Lists Grid -->
      <div *ngIf="!isLoading && currentView === 'lists'" class="lists-grid">
        <div 
          *ngFor="let list of pagedVocabularyLists; let i = index" 
          class="list-card"
          [class.featured]="list.status?.toLowerCase() === 'published'"
          [class.pending-card]="list.status?.toLowerCase() === 'pending'">
          
          <!-- Card Header -->
          <div class="card-header">
            <div class="list-status-section">
              <span class="status-badge" [ngClass]="getStatusClass(list.status)">
                <i class="fas fa-circle status-dot"></i>
                {{getStatusText(list.status)}}
              </span>
            </div>
            
            <div class="card-actions">
              <div class="action-buttons">
                <button 
                  *ngIf="canSendBackToStaff(list)"
                  class="btn-action btn-undo" 
                  (click)="sendBackToStaff(list)"
                  title="Gửi về staff">
                  <i class="fas fa-undo"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Card Body -->
          <div class="card-body">
            <h3 class="list-name">{{ list.name }}</h3>
            
            <div class="list-meta">
              <div class="meta-item">
                <i class="fas fa-user"></i>
                <span>{{ list.makeByName }}</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-calendar"></i>
                <span>{{ list.createAt | date:'dd/MM/yyyy' }}</span>
              </div>
            </div>

            <div class="list-stats">
              <div class="stat-item">
                <i class="fas fa-book"></i>
                <span>{{ list.vocabularyCount || 0 }} từ vựng</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-globe" *ngIf="list.isPublic"></i>
                <i class="fas fa-lock" *ngIf="!list.isPublic"></i>
                <span>{{ list.isPublic ? 'Công khai' : 'Riêng tư' }}</span>
              </div>
            </div>

            <!-- Rejection Reason Alert -->
            <div *ngIf="list.rejectionReason" class="rejection-alert">
              <div class="alert-header">
                <i class="fas fa-exclamation-triangle"></i>
                <span class="alert-title">Danh sách đã bị từ chối</span>
              </div>
              <div class="alert-content">
                <p class="rejection-reason">{{ list.rejectionReason }}</p>
              </div>
            </div>
          </div>

          <!-- Card Footer -->
          <div class="card-footer">
            <button 
              class="btn-primary-card"
              (click)="selectList(list)">
              <i class="fas fa-eye"></i>
              Xem chi tiết
            </button>
            
            <button 
              *ngIf="canReview(list)"
              class="btn-success-card"
              (click)="approveList(list); $event.stopPropagation()"
              [disabled]="isApproving || isRejecting"
              type="button">
              <i *ngIf="isApproving" class="fas fa-spinner fa-spin"></i>
              <i *ngIf="!isApproving" class="fas fa-check"></i>
              {{isApproving ? 'Đang duyệt...' : 'Duyệt'}}
            </button>
            
            <button 
              *ngIf="canReview(list)"
              class="btn-danger-card"
              (click)="rejectList(list); $event.stopPropagation()"
              [disabled]="isApproving || isRejecting"
              type="button">
              <i *ngIf="isRejecting" class="fas fa-spinner fa-spin"></i>
              <i *ngIf="!isRejecting" class="fas fa-times"></i>
              {{isRejecting ? 'Đang từ chối...' : 'Từ chối'}}
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && currentView === 'lists' && pagedVocabularyLists.length === 0" class="empty-state">
        <i class="fas fa-inbox"></i>
        <h3>Không có danh sách nào</h3>
        <p *ngIf="statusFilter !== 'all' || searchTerm">
          Không tìm thấy danh sách nào phù hợp với bộ lọc hiện tại.
          <button (click)="statusFilter = 'all'; searchTerm = ''; onStatusFilterChange()" class="btn-link">Xóa bộ lọc</button>
        </p>
        <p *ngIf="statusFilter === 'all' && !searchTerm">
          Chưa có danh sách từ vựng nào cần duyệt.
        </p>
      </div>

      <!-- Vocabulary Words View -->
      <div *ngIf="!isLoading && currentView === 'words'" class="words-view">
        <div class="words-header">
          <button class="btn-back" (click)="showListView()">
            <i class="fas fa-arrow-left"></i>
            Quay lại
          </button>
          <h2>{{ selectedList?.name }}</h2>
        </div>

        <div class="words-grid">
          <div 
            *ngFor="let vocab of pagedVocabularies" 
            class="word-card">
            
            <!-- Image Section -->
            <div *ngIf="vocab.imageUrl" class="word-image-container">
              <img 
                [src]="vocab.imageUrl" 
                [alt]="'Image for ' + vocab.word" 
                class="word-image"
                loading="lazy"
                (error)="handleImageError($event, vocab)" />
            </div>

            <div class="word-header">
              <h4 class="word-text">{{ vocab.word }}</h4>
              <span class="part-of-speech" [ngClass]="getPartOfSpeechClass(vocab.partOfSpeech)">
                {{ vocab.partOfSpeech }}
              </span>
            </div>

            <div class="word-body">
              <div class="definition">
                <strong>Định nghĩa:</strong>
                <p [innerHTML]="sanitizeHtml(vocab.definition)"></p>
              </div>
              
              <div class="example" *ngIf="vocab.example">
                <strong>Ví dụ:</strong>
                <p [innerHTML]="sanitizeHtml(vocab.example)"></p>
              </div>
              
              <div class="category" *ngIf="vocab.category">
                <strong>Danh mục:</strong>
                <span class="category-tag">{{ getCategoryName(vocab.category) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="pagedVocabularies.length === 0" class="empty-state">
          <i class="fas fa-book"></i>
          <h3>Không có từ vựng nào</h3>
          <p>Danh sách này chưa có từ vựng nào.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="totalPages > 1" class="pagination">
    <div class="pagination-info">
      Showing {{getStartIndex()}} - {{getEndIndex()}} of {{totalItems}} {{currentView === 'lists' ? 'lists' : 'words'}}
    </div>
    <div class="pagination-controls">
      <button 
        class="pagination-btn" 
        [disabled]="page === 1"
        (click)="prevPage()">
        <i class="fas fa-chevron-left"></i>
      </button>
      
      <button 
        *ngFor="let pageNum of getPageNumbers()" 
        class="pagination-btn"
        [class.active]="pageNum === page"
        (click)="goToPage(pageNum)">
        {{ pageNum }}
      </button>
      
      <button 
        class="pagination-btn" 
        [disabled]="page === totalPages"
        (click)="nextPage()">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Rejection Modal -->
  <div *ngIf="isReviewModalOpen" class="modal-overlay" (click)="cancelReject()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Từ chối danh sách từ vựng</h3>
        <button class="modal-close" (click)="cancelReject()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="reject-info">
          <h4>Danh sách: {{ reviewingList?.name }}</h4>
          <p>Tạo bởi: {{ reviewingList?.makeByName }}</p>
        </div>

        <div class="form-group">
          <label for="rejectionReason" class="form-label">
            Lý do từ chối <span class="required">*</span>
          </label>
          <textarea 
            id="rejectionReason"
            [(ngModel)]="rejectionReason"
            class="form-textarea"
            placeholder="Vui lòng nhập lý do từ chối danh sách từ vựng này (tối thiểu 10 ký tự)..."
            rows="4"
            maxlength="500"
            required>
          </textarea>
          <div class="form-help">
            <span>Lý do từ chối sẽ được gửi đến staff để họ có thể sửa lại danh sách.</span>
            <span class="char-counter">{{rejectionReason.length || 0}} / 500</span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cancelReject()">
          Hủy
        </button>
        <button 
          class="btn btn-danger" 
          (click)="confirmReject()"
          [disabled]="!rejectionReason.trim() || isRejecting || rejectionReason.trim().length < 10">
          <i *ngIf="isRejecting" class="fas fa-spinner fa-spin"></i>
          <i *ngIf="!isRejecting" class="fas fa-times"></i>
          {{ isRejecting ? 'Đang xử lý...' : 'Từ chối danh sách' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Approval Modal -->
<div *ngIf="showApproveModal" class="modal-overlay" (click)="cancelApprove()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Xác nhận duyệt danh sách từ vựng</h3>
      <button class="modal-close" (click)="cancelApprove()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="approve-info">
        <div class="approve-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h4>Danh sách: {{ approvingList?.name }}</h4>
        <p>Tạo bởi: {{ approvingList?.makeByName }}</p>
        <p class="approve-warning">Bạn có chắc chắn muốn duyệt và xuất bản danh sách từ vựng này?</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cancelApprove()" [disabled]="isApproving">
        Hủy
      </button>
      <button 
        class="btn btn-success" 
        (click)="confirmApprove()"
        [disabled]="isApproving">
        <i *ngIf="isApproving" class="fas fa-spinner fa-spin"></i>
        <i *ngIf="!isApproving" class="fas fa-check"></i>
        {{isApproving ? 'Đang duyệt...' : 'Xác nhận duyệt'}}
      </button>
    </div>
  </div>
</div>
