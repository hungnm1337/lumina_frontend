<div class="articles-container">
  <!-- TOEIC Header Section - MANAGER VERSION -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <span class="toeic-badge">TOEIC</span>
          Quản lý bài viết
        </h1>
        <p class="page-subtitle">
          Xem xét và quản lý bài viết từ nhân viên
        </p>
      </div>
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-number">{{stats.totalArticles || 0}}</div>
          <div class="stat-label">Tổng bài viết</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{stats.pendingArticles}}</div>
          <div class="stat-label">Chờ duyệt</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{stats.approvedArticles}}</div>
          <div class="stat-label">Đã duyệt</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Advanced Search & Filter Panel -->
  <div class="search-filter-panel">
    <div class="search-section">
      <div class="search-input-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchInput($event)"
          placeholder="Tìm kiếm bài viết, nội dung, tác giả..."
          class="search-input"
          maxlength="100">
        <button 
          *ngIf="searchTerm" 
          (click)="clearSearch()" 
          class="clear-search-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <div class="filters-section">
      <div class="filter-group">
        <label>Trạng thái</label>
        <select [(ngModel)]="selectedStatus" (change)="onStatusChange()" class="filter-select">
          <option value="all">Tất cả trạng thái</option>
          <option value="pending">Chờ duyệt</option>
          <option value="approved">Đã duyệt</option>
          <option value="rejected">Đã từ chối</option>
        </select>
      </div>

      <div class="filter-actions">
        <button (click)="clearFilters()" class="btn-clear-filters">
          <i class="fas fa-eraser"></i>
          Xóa tất cả
        </button>
        <button (click)="loadArticles()" class="btn-refresh">
          <i class="fas fa-sync-alt"></i>
          Làm mới
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Articles List -->
    <div class="articles-list-section">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
        <p>Đang tải bài viết...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="errorMessage && !isLoading" class="error-state">
        <div class="error-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3>Không thể tải dữ liệu</h3>
        <p>{{ errorMessage }}</p>
        <button class="retry-btn" (click)="loadArticles()">
          <i class="fas fa-redo"></i>
          Thử lại
        </button>
      </div>

      <!-- Articles Grid -->
      <div *ngIf="!isLoading && !errorMessage" class="articles-grid">
        <div
          *ngFor="let article of pagedArticles; let i = index"
          class="article-card"
          [class.featured]="article.status === 'published'">

          <!-- Card Header -->
          <div class="card-header">
            <div class="article-status-section">
              <span class="status-badge" [ngClass]="getStatusClass(article.status)">
                <i class="fas fa-circle status-dot"></i>
                {{getStatusText(article.status, article.rejectionReason)}}
              </span>
            </div>

            <button
  *ngIf="article.status === 'published'"
  class="btn-action"
  [class.btn-hide]="!article.isPublished"
  [class.btn-show]="article.isPublished"
  (click)="toggleHideArticle(article)"
  [title]="article.isPublished ? 'Ẩn bài viết' : 'Hiển thị bài viết'">

  <i class="fas" [ngClass]="article.isPublished ? 'fa-eye' : 'fa-eye-slash'"></i>

</button>
          </div>

          <!-- Card Content -->
          <div class="card-content">
            <!-- Title & Category -->
            <div class="article-meta-top">
              <h3 class="article-title">{{article.title}}</h3>
              <span class="category-tag">
                <i class="fas fa-tag"></i>
                {{article.category}}
              </span>
            </div>

            <!-- Summary -->
            <div class="article-summary">
              <p class="summary-text">{{article.summary}}</p>
            </div>

            <!-- Rejection Reason Alert -->
            <div *ngIf="article.rejectionReason" class="rejection-alert">
              <div class="alert-header">
                <i class="fas fa-exclamation-triangle"></i>
                <span class="alert-title">Bài viết đã bị từ chối</span>
              </div>
              <div class="alert-content">
                <p class="rejection-reason">{{ article.rejectionReason }}</p>
              </div>
            </div>

            <!-- Article Info -->
            <div class="article-info-section">
              <div class="info-item">
                <i class="fas fa-user"></i>
                <span>{{article.author}}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-calendar"></i>
                <span>{{article.publishDate}}</span>
              </div>
            </div>
          </div>

          <!-- Card Footer -->
          <div class="card-footer">
            <button
              class="btn-primary-card"
              (click)="viewArticle(article)">
              <i class="fas fa-eye"></i>
              Xem
            </button>

            <button
              *ngIf="article.status === 'pending'"
              class="btn-success-card"
              (click)="approveArticle(article)"
              [disabled]="isApproving || isRejecting">
              <i *ngIf="isApproving" class="fas fa-spinner fa-spin"></i>
              <i *ngIf="!isApproving" class="fas fa-check"></i>
              {{isApproving ? 'Đang duyệt...' : 'Duyệt'}}
            </button>

            <button
              *ngIf="article.status === 'pending'"
              class="btn-danger-card"
              (click)="rejectArticle(article)"
              [disabled]="isApproving || isRejecting">
              <i *ngIf="isRejecting" class="fas fa-spinner fa-spin"></i>
              <i *ngIf="!isRejecting" class="fas fa-times"></i>
              {{isRejecting ? 'Đang từ chối...' : 'Từ chối'}}
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && !errorMessage && filteredArticles.length === 0" class="empty-state">
        <i class="fas fa-file-alt"></i>
        <h3>Không có bài viết nào</h3>
        <p *ngIf="selectedStatus !== 'all' || searchTerm">
          Không tìm thấy bài viết nào phù hợp với bộ lọc hiện tại.
          <button (click)="clearFilters()" class="btn-link">Xóa bộ lọc</button>
        </p>
        <p *ngIf="selectedStatus === 'all' && !searchTerm">
          Chưa có bài viết nào cần duyệt.
        </p>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="totalPages > 1" class="pagination">
    <div class="pagination-info">
      Showing {{(page - 1) * pageSize + 1}} - {{Math.min(page * pageSize, totalItems)}} of {{totalItems}} articles
    </div>
    <div class="pagination-controls">
      <button 
        class="pagination-btn" 
        [disabled]="page === 1"
        (click)="prevPage()">
        <i class="fas fa-chevron-left"></i>
      </button>
      
      <button 
        *ngFor="let pageNum of getPageNumbers()" 
        class="pagination-btn"
        [class.active]="pageNum === page"
        (click)="goToPage(pageNum)">
        {{ pageNum }}
      </button>
      
      <button 
        class="pagination-btn" 
        [disabled]="page === totalPages"
        (click)="nextPage()">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<!-- Rejection Modal -->
<div *ngIf="showRejectModal" class="modal-overlay" (click)="cancelReject()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Từ chối bài viết</h3>
      <button class="modal-close" (click)="cancelReject()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="reject-info">
        <h4>Bài viết: {{ rejectingArticle?.title }}</h4>
        <p>Tác giả: {{ rejectingArticle?.author }}</p>
      </div>

      <div class="form-group">
        <label for="rejectionReason" class="form-label">
          Lý do từ chối <span class="required">*</span>
        </label>
        <textarea
          id="rejectionReason"
          [(ngModel)]="rejectionReason"
          class="form-textarea"
          placeholder="Vui lòng nhập lý do từ chối bài viết này (tối thiểu 10 ký tự)..."
          rows="4"
          maxlength="500"
          required>
        </textarea>
        <div class="form-help">
          <span>Lý do từ chối sẽ được gửi đến tác giả để họ có thể sửa lại bài viết.</span>
          <span class="char-counter">{{rejectionReason.length || 0}} / 500</span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cancelReject()">
        Hủy
      </button>
      <button
        class="btn btn-danger"
        (click)="confirmReject()"
        [disabled]="!rejectionReason.trim() || isRejecting || rejectionReason.trim().length < 10">
        <i *ngIf="isRejecting" class="fas fa-spinner fa-spin"></i>
        <i *ngIf="!isRejecting" class="fas fa-times"></i>
        {{isRejecting ? 'Đang xử lý...' : 'Từ chối bài viết'}}
      </button>
    </div>
  </div>
</div>

<!-- Approval Modal -->
<div *ngIf="showApproveModal" class="modal-overlay" (click)="cancelApprove()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Xác nhận duyệt bài viết</h3>
      <button class="modal-close" (click)="cancelApprove()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="approve-info">
        <div class="approve-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h4>Bài viết: {{ approvingArticle?.title }}</h4>
        <p>Tác giả: {{ approvingArticle?.author }}</p>
        <p class="approve-warning">Bạn có chắc chắn muốn duyệt và xuất bản bài viết này?</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cancelApprove()" [disabled]="isApproving">
        Hủy
      </button>
      <button 
        class="btn btn-success" 
        (click)="confirmApprove()"
        [disabled]="isApproving">
        <i *ngIf="isApproving" class="fas fa-spinner fa-spin"></i>
        <i *ngIf="!isApproving" class="fas fa-check"></i>
        {{isApproving ? 'Đang duyệt...' : 'Xác nhận duyệt'}}
      </button>
    </div>
  </div>
</div>
