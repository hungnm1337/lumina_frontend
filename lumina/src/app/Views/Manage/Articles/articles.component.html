<div class="articles-container">
  <!-- TOEIC Header Section - MANAGER VERSION -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <span class="toeic-badge">TOEIC</span>
          Article Management
        </h1>
        <p class="page-subtitle">
          Review and manage articles from staff
        </p>
      </div>
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-number">{{stats.totalArticles || 0}}</div>
          <div class="stat-label">Total Articles</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{stats.pendingArticles}}</div>
          <div class="stat-label">Pending</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{stats.approvedArticles}}</div>
          <div class="stat-label">Published</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Advanced Search & Filter Panel -->
  <div class="search-filter-panel">
    <div class="search-section">
      <div class="search-input-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="page = 1"
          placeholder="Search articles, content, authors..."
          class="search-input">
        <button 
          *ngIf="searchTerm" 
          (click)="clearSearch()" 
          class="clear-search-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <div class="filters-section">
      <div class="filter-group">
        <label>Status</label>
        <select [(ngModel)]="selectedStatus" (change)="onStatusChange()" class="filter-select">
          <option value="all">All Status</option>
          <option value="pending">Pending</option>
          <option value="approved">Approved</option>
          <option value="rejected">Rejected</option>
        </select>
      </div>

      <div class="filter-actions">
        <button (click)="clearFilters()" class="btn-clear-filters">
          <i class="fas fa-eraser"></i>
          Clear All
        </button>
        <button (click)="loadArticles()" class="btn-refresh">
          <i class="fas fa-sync-alt"></i>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Articles List -->
    <div class="articles-list-section">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
        <p>Loading articles...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="errorMessage && !isLoading" class="error-state">
        <div class="error-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3>Không thể tải dữ liệu</h3>
        <p>{{ errorMessage }}</p>
        <button class="retry-btn" (click)="loadArticles()">
          <i class="fas fa-redo"></i>
          Thử lại
        </button>
      </div>

      <!-- Articles Grid -->
      <div *ngIf="!isLoading && !errorMessage" class="articles-grid">
        <div 
          *ngFor="let article of pagedArticles; let i = index" 
          class="article-card"
          [class.featured]="article.status === 'published'">
          
          <!-- Card Header -->
          <div class="card-header">
            <div class="article-status-section">
              <span class="status-badge" [ngClass]="getStatusClass(article.status)">
                <i class="fas fa-circle status-dot"></i>
                {{getStatusText(article.status, article.rejectionReason)}}
              </span>
            </div>
            
            <button 
  *ngIf="article.status === 'published'"
  class="btn-action" 
  [class.btn-hide]="!article.isPublished"
  [class.btn-show]="article.isPublished"
  (click)="toggleHideArticle(article)"
  [title]="article.isPublished ? 'Ẩn bài viết' : 'Hiển thị bài viết'">
  
  <i class="fas" [ngClass]="article.isPublished ? 'fa-eye' : 'fa-eye-slash'"></i>

</button>
          </div>

          <!-- Card Content -->
          <div class="card-content">
            <!-- Title & Category -->
            <div class="article-meta-top">
              <h3 class="article-title">{{article.title}}</h3>
              <span class="category-tag">
                <i class="fas fa-tag"></i>
                {{article.category}}
              </span>
            </div>

            <!-- Summary -->
            <div class="article-summary">
              <p class="summary-text">{{article.summary}}</p>
            </div>

            <!-- Rejection Reason Alert -->
            <div *ngIf="article.rejectionReason" class="rejection-alert">
              <div class="alert-header">
                <i class="fas fa-exclamation-triangle"></i>
                <span class="alert-title">Bài viết đã bị từ chối</span>
              </div>
              <div class="alert-content">
                <p class="rejection-reason">{{ article.rejectionReason }}</p>
              </div>
            </div>

            <!-- Article Info -->
            <div class="article-info-section">
              <div class="info-item">
                <i class="fas fa-user"></i>
                <span>{{article.author}}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-calendar"></i>
                <span>{{article.publishDate}}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-eye"></i>
                <span>{{article.views}} views</span>
              </div>
              <div class="info-item">
                <i class="fas fa-heart"></i>
                <span>{{article.likes}} likes</span>
              </div>
            </div>
          </div>

          <!-- Card Footer -->
          <div class="card-footer">
            <button 
              class="btn-primary-card"
              (click)="viewArticle(article)">
              <i class="fas fa-eye"></i>
              Xem
            </button>
            
            <button 
              *ngIf="article.status === 'pending'"
              class="btn-success-card"
              (click)="approveArticle(article)">
              <i class="fas fa-check"></i>
              Duyệt
            </button>
            
            <button 
              *ngIf="article.status === 'pending'"
              class="btn-danger-card"
              (click)="rejectArticle(article)">
              <i class="fas fa-times"></i>
              Từ chối
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && !errorMessage && filteredArticles.length === 0" class="empty-state">
        <i class="fas fa-file-alt"></i>
        <h3>Không có bài viết nào</h3>
        <p>Không tìm thấy bài viết nào phù hợp với bộ lọc hiện tại</p>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="totalPages > 1" class="pagination">
    <button 
      class="pagination-btn" 
      [disabled]="page === 1"
      (click)="prevPage()">
      <i class="fas fa-chevron-left"></i>
    </button>
    
    <button 
      *ngFor="let pageNum of getPageNumbers()" 
      class="pagination-btn"
      [class.active]="pageNum === page"
      (click)="goToPage(pageNum)">
      {{ pageNum }}
    </button>
    
    <button 
      class="pagination-btn" 
      [disabled]="page === totalPages"
      (click)="nextPage()">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>

<!-- Rejection Modal -->
<div *ngIf="showRejectModal" class="modal-overlay" (click)="cancelReject()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Từ chối bài viết</h3>
      <button class="modal-close" (click)="cancelReject()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="reject-info">
        <h4>Bài viết: {{ rejectingArticle?.title }}</h4>
        <p>Tác giả: {{ rejectingArticle?.author }}</p>
      </div>

      <div class="form-group">
        <label for="rejectionReason" class="form-label">
          Lý do từ chối <span class="required">*</span>
        </label>
        <textarea 
          id="rejectionReason"
          [(ngModel)]="rejectionReason"
          class="form-textarea"
          placeholder="Vui lòng nhập lý do từ chối bài viết này..."
          rows="4"
          required>
        </textarea>
        <div class="form-help">
          Lý do từ chối sẽ được gửi đến tác giả để họ có thể sửa lại bài viết.
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cancelReject()">
        Hủy
      </button>
      <button 
        class="btn btn-danger" 
        (click)="confirmReject()"
        [disabled]="!rejectionReason.trim()">
        <i class="fas fa-times"></i>
        Từ chối bài viết
      </button>
    </div>
  </div>
</div>
