<app-header></app-header>

<div class="vocabulary-list-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <button (click)="goBack()" class="back-button">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
          class="back-icon">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
        </svg>
        <span>Quay l·∫°i</span>
      </button>
      <div class="title-wrapper">
        <h1 class="page-title">
          <span class="toeic-badge">TOEIC</span>
          Danh S√°ch T·ª´ V·ª±ng Spaced Repetition
        </h1>
        <p class="page-subtitle">Theo d√µi chi ti·∫øt ti·∫øn ƒë·ªô h·ªçc t·∫≠p c·ªßa t·ª´ng t·ª´ v·ª±ng</p>
      </div>
    </div>
  </div>


  <div class="filters-section">
    <div class="filters-container">
  
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" [(ngModel)]="searchQuery" (input)="applyFilters()"
          placeholder="T√¨m ki·∫øm t·ª´ ho·∫∑c ƒë·ªãnh nghƒ©a..." class="search-input">
      </div>

      <div class="filter-group">
        <label class="filter-label">Tr·∫°ng th√°i:</label>
        <select [(ngModel)]="statusFilter" (change)="applyFilters()" class="filter-select">
          <option value="all">T·∫•t c·∫£</option>
          <option value="New">M·ªõi</option>
          <option value="Learning">ƒêang h·ªçc</option>
          <option value="Mastered">ƒê√£ thu·ªôc</option>
        </select>
      </div>

      <div class="stats-summary">
        <div class="stat-item">
          <i class="fas fa-book"></i>
          <span class="stat-value">{{ filteredRows.length }}</span>
          <span class="stat-label">t·ª´ v·ª±ng</span>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>ƒêang t·∫£i danh s√°ch t·ª´ v·ª±ng...</p>
  </div>

  <div *ngIf="!isLoading && filteredRows.length === 0" class="empty-state">
    <div class="empty-icon">üìö</div>
    <h3>Kh√¥ng t√¨m th·∫•y t·ª´ v·ª±ng n√†o</h3>
    <p *ngIf="searchQuery">Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c</p>
    <p *ngIf="!searchQuery">B·∫°n ch∆∞a c√≥ t·ª´ v·ª±ng n√†o trong h·ªá th·ªëng spaced repetition</p>
  </div>
  <div *ngIf="!isLoading && filteredRows.length > 0" class="table-container">

    <div class="desktop-table">
      <table class="vocabulary-table">
        <thead>
          <tr>
            <th class="sortable" (click)="setSortBy('word')">
              <div class="th-content">
                <span>T·ª´ v·ª±ng</span>
                <i class="fas" [ngClass]="{
                  'fa-sort': sortBy !== 'word',
                  'fa-sort-up': sortBy === 'word' && sortDirection === 'asc',
                  'fa-sort-down': sortBy === 'word' && sortDirection === 'desc'
                }"></i>
              </div>
            </th>
            <th>ƒê·ªãnh nghƒ©a</th>
            <th class="sortable" (click)="setSortBy('status')">
              <div class="th-content">
                <span>Tr·∫°ng th√°i</span>
                <i class="fas" [ngClass]="{
                  'fa-sort': sortBy !== 'status',
                  'fa-sort-up': sortBy === 'status' && sortDirection === 'asc',
                  'fa-sort-down': sortBy === 'status' && sortDirection === 'desc'
                }"></i>
              </div>
            </th>
            <th class="sortable" (click)="setSortBy('intervals')">
              <div class="th-content">
                <span>Interval</span>
                <i class="fas" [ngClass]="{
                  'fa-sort': sortBy !== 'intervals',
                  'fa-sort-up': sortBy === 'intervals' && sortDirection === 'asc',
                  'fa-sort-down': sortBy === 'intervals' && sortDirection === 'desc'
                }"></i>
              </div>
            </th>
            <th>ƒê·ªô d·ªÖ nh·ªõ</th>
            <th>S·ªë l·∫ßn review</th>
            <th class="sortable" (click)="setSortBy('nextReview')">
              <div class="th-content">
                <span>Review ti·∫øp theo</span>
                <i class="fas" [ngClass]="{
                  'fa-sort': sortBy !== 'nextReview',
                  'fa-sort-up': sortBy === 'nextReview' && sortDirection === 'asc',
                  'fa-sort-down': sortBy === 'nextReview' && sortDirection === 'desc'
                }"></i>
              </div>
            </th>
            <th>Folder</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of paginatedRows" (click)="goToDeck(row.vocabularyListId)" class="vocabulary-row">
 
            <td class="word-cell">
              <div class="word-content">
                <span class="word">{{ row.word }}</span>
                <span *ngIf="row.category" class="category-badge">{{ row.category }}</span>
              </div>
            </td>

            <td class="definition-cell">
              <div class="definition-content">
                <p class="definition">{{ row.definition }}</p>
                <span *ngIf="row.type" class="type-text">
                  <i class="fas fa-tag"></i>
                  {{ row.type }}
                </span>
              </div>
            </td>

            <td class="status-cell">
              <span class="status-badge" [ngClass]="getStatusClass(row.status)">
                {{ row.status }}
              </span>
            </td>

            <td class="intervals-cell">
              <div class="intervals-content">
                <span class="intervals-value">{{ row.intervals }} ng√†y</span>
                <span class="intervals-milestone">{{ getIntervalMilestones(row.intervals) }}</span>
              </div>
            </td>

            <td class="quality-cell">
              <div class="quality-content" *ngIf="row.quality !== undefined">
                <div class="quality-bar-container">
                  <div class="quality-bar" [ngClass]="getQualityClass(row.quality)" [style.width.%]="row.quality * 20">
                  </div>
                </div>
                <span class="quality-value">{{ row.quality }}/5</span>
              </div>
              <span *ngIf="row.quality === undefined" class="no-data">-</span>
            </td>

            <td class="review-count-cell">
              <div class="review-count-content">
                <i class="fas fa-redo-alt"></i>
                <span>{{ row.reviewCount }} l·∫ßn</span>
              </div>
            </td>

            <td class="next-review-cell">
              <div class="next-review-content">
                <span class="date">{{ formatDate(row.nextReviewAt) }}</span>
                <span class="days-until" *ngIf="row.nextReviewAt" [ngClass]="{
                  'overdue': getDaysUntilReview(row.nextReviewAt) < 0,
                  'due-soon': getDaysUntilReview(row.nextReviewAt) >= 0 && getDaysUntilReview(row.nextReviewAt) <= 1,
                  'upcoming': getDaysUntilReview(row.nextReviewAt) > 1
                }">
                  <ng-container *ngIf="getDaysUntilReview(row.nextReviewAt) === 0">H√¥m nay</ng-container>
                  <ng-container *ngIf="getDaysUntilReview(row.nextReviewAt) === 1">Ng√†y mai</ng-container>
                  <ng-container *ngIf="getDaysUntilReview(row.nextReviewAt) < 0">Qu√° {{
                    -getDaysUntilReview(row.nextReviewAt) }} ng√†y</ng-container>
                  <ng-container *ngIf="getDaysUntilReview(row.nextReviewAt) > 1">C√≤n {{
                    getDaysUntilReview(row.nextReviewAt) }} ng√†y</ng-container>
                </span>
              </div>
            </td>

            <td class="folder-cell">
              <span class="folder-name">{{ row.vocabularyListName }}</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="mobile-cards">
      <div *ngFor="let row of paginatedRows" class="vocab-card" (click)="goToDeck(row.vocabularyListId)">
        <div class="card-header">
          <h3 class="word">{{ row.word }}</h3>
          <span class="status-badge" [ngClass]="getStatusClass(row.status)">{{ row.status }}</span>
        </div>

        <div class="card-body">
          <p class="definition">{{ row.definition }}</p>

          <div class="card-stats">
            <div class="stat-row">
              <span class="stat-label">Interval:</span>
              <span class="stat-value">{{ row.intervals }} ng√†y</span>
            </div>

            <div class="stat-row" *ngIf="row.quality !== undefined">
              <span class="stat-label">ƒê·ªô d·ªÖ nh·ªõ:</span>
              <span class="stat-value">{{ row.quality }}/5</span>
            </div>

            <div class="stat-row">
              <span class="stat-label">Review:</span>
              <span class="stat-value">{{ row.reviewCount }} l·∫ßn</span>
            </div>

            <div class="stat-row" *ngIf="row.nextReviewAt">
              <span class="stat-label">L·∫ßn sau:</span>
              <span class="stat-value">{{ formatDate(row.nextReviewAt) }}</span>
            </div>

            <div class="stat-row">
              <span class="stat-label">Folder:</span>
              <span class="stat-value">{{ row.vocabularyListName }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="pagination-container" *ngIf="totalPages > 1">
      <button class="pagination-btn" [disabled]="currentPage === 1" (click)="previousPage()">
        <i class="fas fa-chevron-left"></i>
        Tr∆∞·ªõc
      </button>

      <div class="pagination-info">
        <span>Trang {{ currentPage }} / {{ totalPages }}</span>
        <span class="total-items">({{ filteredRows.length }} t·ª´ v·ª±ng)</span>
      </div>

      <button class="pagination-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
        Sau
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>