<app-header></app-header>

<div class="dashboard-container">
  <!-- Header Section -->
  <div class="header-section">
    <button (click)="goBack()" class="back-button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"
        class="back-icon">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
      </svg>
      <span>Quay l·∫°i</span>
    </button>
    <div class="header-content">
      <h1 class="page-title">Dashboard H·ªçc T·∫≠p Th√¥ng Minh</h1>
      <p class="page-subtitle">Theo d√µi v√† qu·∫£n l√Ω ti·∫øn ƒë·ªô h·ªçc t·ª´ v·ª±ng v·ªõi Spaced Repetition</p>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-section">
    <div class="stats-grid">
      <!-- Due Today Card -->
      <div class="stat-card stat-card-red">
        <div class="stat-icon">
          <i class="fas fa-exclamation-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ isLoadingStats ? '...' : (spacedRepetitionStats?.dueToday || 0) }}</div>
          <div class="stat-label">C·∫ßn review</div>
        </div>
      </div>

      <!-- Mastered Card -->
      <div class="stat-card stat-card-green">
        <div class="stat-icon">
          <i class="fas fa-trophy"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ isLoadingStats ? '...' : (spacedRepetitionStats?.mastered || 0) }}</div>
          <div class="stat-label">ƒê√£ thu·ªôc</div>
        </div>
      </div>

      <!-- Upcoming Card -->
      <div class="stat-card stat-card-blue">
        <div class="stat-icon">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ isLoadingStats ? '...' : (spacedRepetitionStats?.upcoming || 0) }}</div>
          <div class="stat-label">C·∫ßn h·ªçc s·∫Øp t·ªõi</div>
        </div>
      </div>
    </div>

    <!-- New: Button to Vocabulary List Table -->
    <div class="action-center" style="margin-top: 24px; text-align: center;">
      <button class="btn-view-all-vocabulary" routerLink="/spaced-repetition/vocabulary-list">
        <i class="fas fa-table"></i>
        <span>Xem danh s√°ch ƒë·∫ßy ƒë·ªß t·ª´ v·ª±ng</span>
        <i class="fas fa-arrow-right"></i>
      </button>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions-section" *ngIf="dueTodayWords && dueTodayWords.length > 0">
    <div class="quick-action-card">
      <div class="quick-action-content">
        <div class="quick-action-info">
          <h3>B·∫Øt ƒë·∫ßu √¥n l·∫°i ngay</h3>
          <p>C√≥ {{ dueTodayWords.length }} t·ª´ v·ª±ng c·∫ßn review h√¥m nay</p>
        </div>
        <button class="action-button action-button-primary" (click)="startReviewQuiz()">
          <i class="fas fa-play mr-2"></i>B·∫Øt ƒë·∫ßu
        </button>
      </div>
    </div>
  </div>

  <!-- Due Today Section -->
  <div class="section">
    <div class="section-header">
      <div class="section-title-group">
        <i class="fas fa-exclamation-triangle text-orange-600"></i>
        <h2 class="section-title">C·∫ßn review h√¥m nay</h2>
      </div>
      <span class="badge badge-due" *ngIf="!isLoadingDue">{{ dueTodayWords.length }}</span>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoadingDue" class="loading-state">
      <div class="loading-spinner"></div>
      <p>ƒêang t·∫£i...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoadingDue && dueTodayWords.length === 0" class="empty-state">
      <div class="empty-icon">üéâ</div>
      <h3>Kh√¥ng c√≥ t·ª´ v·ª±ng n√†o c·∫ßn review!</h3>
      <p>B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c t·ª´ v·ª±ng c·∫ßn review h√¥m nay.</p>
    </div>

    <!-- Quiz Button for Due Today Words -->
    <div *ngIf="!isLoadingDue && dueTodayWords.length > 0" class="mb-6">
      <button class="action-button action-button-primary w-full" (click)="startReviewQuiz()">
        <i class="fas fa-question-circle mr-2"></i>
        L√†m b√†i ki·ªÉm tra ({{ dueTodayWords.length }} t·ª´)
      </button>
      <p class="text-sm text-gray-600 mt-2 text-center">
        <i class="fas fa-info-circle mr-1"></i>
        L√†m ƒë√∫ng: t·ª´ s·∫Ω kh√¥ng hi·ªÉn th·ªã n·ªØa. L√†m sai: t·ª´ s·∫Ω ƒë∆∞·ª£c chuy·ªÉn v√†o danh s√°ch h·ªçc ng√†y mai.
      </p>
    </div>

    <!-- Due Today Vocabulary Grid -->
    <div *ngIf="!isLoadingDue && dueTodayWords.length > 0">
      <div class="vocabulary-grid">
        <div *ngFor="let item of dueTodayWords" class="vocabulary-card upcoming-vocab"
          (click)="goToDeck(item.reviewInfo.vocabularyListId)">
          <div class="vocab-header">
            <h3 class="vocab-word">{{ item.vocabulary.word }}</h3>
            <span class="badge" *ngIf="item.vocabulary.category">
              {{ item.vocabulary.category }}
            </span>
          </div>
          <div class="vocab-content">
            <p class="vocab-definition">{{ item.vocabulary.definition }}</p>
            <div class="vocab-meta" *ngIf="item.vocabulary.type">
              <i class="fas fa-tag"></i>
              <span>{{ item.vocabulary.type }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Missed Words Section -->
  <div class="section" *ngIf="!isLoadingStats && missedWords.length > 0">
    <div class="section-header">
      <div class="section-title-group">
        <i class="fas fa-exclamation-circle text-red-600"></i>
        <h2 class="section-title">C√°c t·ª´ v·ª±ng ƒë√£ b·ªè l·ª°</h2>
      </div>
      <span class="badge badge-due">{{ missedWords.length }}</span>
    </div>

    <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
      <p class="text-sm text-red-800">
        <i class="fas fa-info-circle mr-2"></i>
        Nh·ªØng t·ª´ v·ª±ng n√†y ƒë√£ ƒë·∫øn h·∫πn review nh∆∞ng b·∫°n ch∆∞a h·ªçc. H√£y h·ªçc l·∫°i ƒë·ªÉ kh√¥ng b·ªè l·ª° ti·∫øn ƒë·ªô!
      </p>
    </div>

    <!-- Missed Words Grid -->
    <div class="vocabulary-grid">
      <div *ngFor="let item of missedWords" class="vocabulary-card missed-vocab"
        (click)="goToDeck(item.reviewInfo.vocabularyListId)">
        <div class="vocab-header">
          <h3 class="vocab-word">{{ item.vocabulary.word }}</h3>
          <span class="badge" *ngIf="item.vocabulary.category">
            {{ item.vocabulary.category }}
          </span>
        </div>
        <div class="vocab-content">
          <p class="vocab-definition">{{ item.vocabulary.definition }}</p>
          <div class="vocab-meta" *ngIf="item.vocabulary.type">
            <i class="fas fa-tag"></i>
            <span>{{ item.vocabulary.type }}</span>
          </div>
          <div class="vocab-meta text-red-600" *ngIf="item.reviewInfo.nextReviewAt">
            <i class="fas fa-calendar-times"></i>
            <span>ƒê√£ qu√° h·∫°n: {{ getDaysOverdue(item.reviewInfo.nextReviewAt) }} ng√†y</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tomorrow's Review Section -->
  <div class="section">
    <div class="section-header">
      <div class="section-title-group">
        <i class="fas fa-calendar-alt text-blue-600"></i>
        <h2 class="section-title">L·ªãch h·ªçc ng√†y mai</h2>
      </div>
      <span class="badge badge-upcoming" *ngIf="!isLoadingUpcoming">{{ upcomingVocabularies.length }}</span>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoadingUpcoming" class="loading-state">
      <div class="loading-spinner"></div>
      <p>ƒêang t·∫£i...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoadingUpcoming && upcomingVocabularies.length === 0" class="empty-state">
      <div class="empty-icon">üìÖ</div>
      <h3>Kh√¥ng c√≥ t·ª´ v·ª±ng n√†o c·∫ßn h·ªçc ng√†y mai</h3>
      <p>C√°c t·ª´ v·ª±ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c review ho·∫∑c ch∆∞a ƒë∆∞·ª£c l√™n l·ªãch.</p>
    </div>

    <!-- Upcoming Vocabulary Grid -->
    <div *ngIf="!isLoadingUpcoming && upcomingVocabularies.length > 0">
      <div class="vocabulary-grid">
        <div *ngFor="let item of paginatedUpcomingVocabularies" class="vocabulary-card upcoming-vocab"
          (click)="goToDeck(item.reviewInfo.vocabularyListId)">
          <div class="vocab-header">
            <h3 class="vocab-word">{{ item.vocabulary.word }}</h3>
            <span class="badge" *ngIf="item.vocabulary.category">
              {{ item.vocabulary.category }}
            </span>
          </div>
          <div class="vocab-content">
            <p class="vocab-definition">{{ item.vocabulary.definition }}</p>
            <div class="vocab-meta" *ngIf="item.vocabulary.type">
              <i class="fas fa-tag"></i>
              <span>{{ item.vocabulary.type }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination Controls (Carousel Style) -->
      <div *ngIf="totalUpcomingPages > 1" class="pagination-carousel">
        <button class="carousel-btn prev-btn" [disabled]="currentUpcomingPage === 1" (click)="previousUpcomingPage()">
          <i class="fas fa-chevron-left"></i>
        </button>

        <div class="carousel-info">
          <span class="page-indicator">{{ currentUpcomingPage }} / {{ totalUpcomingPages }}</span>
        </div>

        <button class="carousel-btn next-btn" [disabled]="currentUpcomingPage === totalUpcomingPages"
          (click)="nextUpcomingPage()">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Unlearned Folders Section -->
  <div class="section" *ngIf="!isLoadingStats && unlearnedFolders.length > 0">
    <div class="section-header">
      <div class="section-title-group">
        <i class="fas fa-folder text-gray-600"></i>
        <h2 class="section-title">Folders ch∆∞a h·ªçc</h2>
      </div>
      <span class="badge badge-default">{{ unlearnedFolders.length }}</span>
    </div>

    <div class="folder-grid">
      <div *ngFor="let item of unlearnedFolders" class="folder-card unlearned-folder"
        (click)="goToDeck(item.vocabularyListId)">
        <div class="folder-card-content">
          <h3 class="folder-card-title">{{ item.vocabularyListName }}</h3>
          <span class="folder-badge badge-new">M·ªõi</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Learned Folders by Date Section -->
  <div class="section" *ngIf="!isLoadingStats && learnedVocabulariesByDate.length > 0">
    <div class="section-header">
      <div class="section-title-group">
        <i class="fas fa-calendar-check text-purple-600"></i>
        <h2 class="section-title">L·ªãch h·ªçc t·∫≠p</h2>
      </div>
    </div>

    <!-- Group by Date -->
    <div *ngFor="let dateGroup of learnedVocabulariesByDate" class="date-group" [attr.data-date-group]="dateGroup.date">
      <div class="date-group-header">
        <h3 class="date-group-title">
          <i class="fas fa-calendar-alt"></i>
          {{ dateGroup.label }}
        </h3>
        <span class="date-group-count">{{ dateGroup.vocabularies.length }} t·ª´ v·ª±ng</span>
      </div>

      <!-- Vocabulary Grid -->
      <div *ngIf="dateGroup.vocabularies.length > 0">
        <div class="vocabulary-grid">
          <div *ngFor="let item of getPaginatedVocabulariesForDate(dateGroup)" class="vocabulary-card progress-vocab"
            (click)="goToDeck(item.reviewInfo.vocabularyListId)">
            <div class="vocab-header">
              <h3 class="vocab-word">{{ item.vocabulary.word }}</h3>
              <span class="badge" *ngIf="item.vocabulary.category">
                {{ item.vocabulary.category }}
              </span>
            </div>
            <div class="vocab-content">
              <p class="vocab-definition">{{ item.vocabulary.definition }}</p>
              <div class="vocab-meta" *ngIf="item.vocabulary.type">
                <i class="fas fa-tag"></i>
                <span>{{ item.vocabulary.type }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Pagination Controls (Carousel Style) -->
        <div *ngIf="getTotalPagesForDate(dateGroup) > 1" class="pagination-carousel">
          <button class="carousel-btn prev-btn" [disabled]="dateGroup.currentPage === 1"
            (click)="previousPageForDate(dateGroup)">
            <i class="fas fa-chevron-left"></i>
          </button>

          <div class="carousel-info">
            <span class="page-indicator">{{ dateGroup.currentPage }} / {{ getTotalPagesForDate(dateGroup) }}</span>
          </div>

          <button class="carousel-btn next-btn" [disabled]="dateGroup.currentPage === getTotalPagesForDate(dateGroup)"
            (click)="nextPageForDate(dateGroup)">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>

      <!-- Empty state for date group -->
      <div *ngIf="dateGroup.vocabularies.length === 0" class="empty-state">
        <p>Kh√¥ng c√≥ t·ª´ v·ª±ng n√†o</p>
      </div>
    </div>
  </div>
</div>