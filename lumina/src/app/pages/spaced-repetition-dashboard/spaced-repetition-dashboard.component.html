<app-header></app-header>

<div class="dashboard-container">
  <!-- Header Section -->
  <div class="header-section">
    <button (click)="goBack()" class="back-button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="back-icon">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
      </svg>
      <span>Quay l·∫°i</span>
    </button>
    <div class="header-content">
      <h1 class="page-title">Dashboard H·ªçc T·∫≠p Th√¥ng Minh</h1>
      <p class="page-subtitle">Theo d√µi v√† qu·∫£n l√Ω ti·∫øn ƒë·ªô h·ªçc t·ª´ v·ª±ng v·ªõi Spaced Repetition</p>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-section">
    <div class="stats-grid">
      <!-- Due Today Card -->
      <div class="stat-card stat-card-red">
        <div class="stat-icon">
          <i class="fas fa-exclamation-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ isLoadingStats ? '...' : (spacedRepetitionStats?.dueToday || 0) }}</div>
          <div class="stat-label">C·∫ßn review</div>
        </div>
      </div>

      <!-- Learning Card -->
      <div class="stat-card stat-card-blue">
        <div class="stat-icon">
          <i class="fas fa-book-reader"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ isLoadingStats ? '...' : (spacedRepetitionStats?.learning || 0) }}</div>
          <div class="stat-label">ƒêang h·ªçc</div>
        </div>
      </div>

      <!-- Mastered Card -->
      <div class="stat-card stat-card-green">
        <div class="stat-icon">
          <i class="fas fa-trophy"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ isLoadingStats ? '...' : (spacedRepetitionStats?.mastered || 0) }}</div>
          <div class="stat-label">ƒê√£ thu·ªôc</div>
        </div>
      </div>

      <!-- Total Card -->
      <div class="stat-card stat-card-purple">
        <div class="stat-icon">
          <i class="fas fa-layer-group"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ isLoadingStats ? '...' : (spacedRepetitionStats?.total || 0) }}</div>
          <div class="stat-label">T·ªïng s·ªë</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions-section" *ngIf="dueTodayLists && dueTodayLists.length > 0">
    <div class="quick-action-card">
      <div class="quick-action-content">
        <div class="quick-action-info">
          <h3>B·∫Øt ƒë·∫ßu √¥n l·∫°i ngay</h3>
          <p>C√≥ {{ dueTodayLists.length }} t·ª´ v·ª±ng c·∫ßn review h√¥m nay</p>
        </div>
        <button class="action-button action-button-primary" (click)="startDueReviews()">
          <i class="fas fa-play mr-2"></i>B·∫Øt ƒë·∫ßu
        </button>
      </div>
    </div>
  </div>

  <!-- Due Today Section -->
  <div class="section">
    <div class="section-header">
      <div class="section-title-group">
        <i class="fas fa-exclamation-triangle text-orange-600"></i>
        <h2 class="section-title">C·∫ßn review h√¥m nay</h2>
      </div>
      <span class="badge badge-due" *ngIf="!isLoadingDue">{{ dueTodayLists.length }}</span>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoadingDue" class="loading-state">
      <div class="loading-spinner"></div>
      <p>ƒêang t·∫£i...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoadingDue && dueTodayLists.length === 0" class="empty-state">
      <div class="empty-icon">üéâ</div>
      <h3>Kh√¥ng c√≥ t·ª´ v·ª±ng n√†o c·∫ßn review!</h3>
      <p>B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c t·ª´ v·ª±ng c·∫ßn review h√¥m nay.</p>
    </div>

    <!-- Due Today List -->
    <div *ngIf="!isLoadingDue && dueTodayLists.length > 0" class="list-container">
      <div 
        *ngFor="let item of dueTodayLists; let i = index" 
        class="due-item-card">
        <div class="due-item-header">
          <div class="due-item-number">{{ i + 1 }}.</div>
          <h3 class="due-item-title">{{ item.vocabularyListName }}</h3>
        </div>
        <div class="due-item-info">
          <div class="info-row">
            <i class="fas fa-calendar-alt text-orange-600"></i>
            <span>Review ti·∫øp theo: <strong>H√¥m nay</strong></span>
          </div>
          <div class="info-row">
            <i class="fas fa-chart-line text-orange-600"></i>
            <span>ƒê√£ review: <strong>{{ item.reviewCount }} l·∫ßn</strong></span>
          </div>
        </div>
        <div class="due-item-actions">
          <button class="btn-review-now" (click)="goToDeck(item.vocabularyListId); $event.stopPropagation()">
            <i class="fas fa-play mr-2"></i>√în l·∫°i ngay
          </button>
          <button class="btn-view-detail" (click)="goToDeck(item.vocabularyListId); $event.stopPropagation()">
            <i class="fas fa-eye mr-2"></i>Xem chi ti·∫øt
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Upcoming Reviews Section -->
  <div class="section">
    <div class="section-header">
      <div class="section-title-group">
        <i class="fas fa-calendar-alt text-blue-600"></i>
        <h2 class="section-title">S·∫Øp ƒë·∫øn l∆∞·ª£t review</h2>
      </div>
      <span class="badge badge-upcoming" *ngIf="!isLoadingUpcoming">{{ upcomingLists.length }}</span>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoadingUpcoming" class="loading-state">
      <div class="loading-spinner"></div>
      <p>ƒêang t·∫£i...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoadingUpcoming && upcomingLists.length === 0" class="empty-state">
      <div class="empty-icon">üìÖ</div>
      <h3>Kh√¥ng c√≥ t·ª´ v·ª±ng n√†o s·∫Øp ƒë·∫øn l∆∞·ª£t</h3>
      <p>C√°c t·ª´ v·ª±ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c review ho·∫∑c ch∆∞a ƒë∆∞·ª£c l√™n l·ªãch.</p>
    </div>

    <!-- Upcoming List -->
    <div *ngIf="!isLoadingUpcoming && upcomingLists.length > 0" class="list-container">
      <div 
        *ngFor="let item of upcomingLists" 
        class="list-item-card upcoming-item"
        (click)="goToDeck(item.vocabularyListId)">
        <div class="item-content">
          <div class="item-header">
            <h3 class="item-title">{{ item.vocabularyListName }}</h3>
            <span class="badge" [ngClass]="getStatusBadgeClass(item.status)">
              {{ item.status }}
            </span>
          </div>
          <div class="item-details">
            <div class="detail-item">
              <i class="fas fa-clock text-blue-600"></i>
              <span>C√≤n {{ getDaysUntilReview(item.nextReviewAt) }} ng√†y</span>
            </div>
            <div class="detail-item">
              <i class="fas fa-calendar-check text-gray-600"></i>
              <span>Review v√†o: {{ formatDate(item.nextReviewAt) }}</span>
            </div>
            <div class="detail-item">
              <i class="fas fa-redo text-gray-600"></i>
              <span>ƒê√£ review: {{ item.reviewCount }} l·∫ßn</span>
            </div>
          </div>
        </div>
        <div class="item-action">
          <i class="fas fa-arrow-right text-blue-600"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- All Learning Progress Section -->
  <div class="section">
    <div class="section-header">
      <div class="section-title-group">
        <i class="fas fa-chart-line text-purple-600"></i>
        <h2 class="section-title">T·∫•t c·∫£ ti·∫øn ƒë·ªô h·ªçc t·∫≠p</h2>
      </div>
      <div class="filter-buttons">
        <button 
          class="filter-btn" 
          [ngClass]="{ 'active': filterStatus === 'all' }"
          (click)="setFilter('all')">
          T·∫•t c·∫£
        </button>
        <button 
          class="filter-btn" 
          [ngClass]="{ 'active': filterStatus === 'due' }"
          (click)="setFilter('due')">
          C·∫ßn review
        </button>
        <button 
          class="filter-btn" 
          [ngClass]="{ 'active': filterStatus === 'learning' }"
          (click)="setFilter('learning')">
          ƒêang h·ªçc
        </button>
        <button 
          class="filter-btn" 
          [ngClass]="{ 'active': filterStatus === 'mastered' }"
          (click)="setFilter('mastered')">
          ƒê√£ thu·ªôc
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoadingStats" class="loading-state">
      <div class="loading-spinner"></div>
      <p>ƒêang t·∫£i...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoadingStats && filteredRepetitions.length === 0" class="empty-state">
      <div class="empty-icon">üìö</div>
      <h3>Ch∆∞a c√≥ d·ªØ li·ªáu h·ªçc t·∫≠p</h3>
      <p>H√£y b·∫Øt ƒë·∫ßu h·ªçc flashcards ƒë·ªÉ theo d√µi ti·∫øn ƒë·ªô!</p>
    </div>

    <!-- All Progress List -->
    <div *ngIf="!isLoadingStats && filteredRepetitions.length > 0" class="list-container">
      <div 
        *ngFor="let item of filteredRepetitions" 
        class="list-item-card progress-item"
        (click)="goToDeck(item.vocabularyListId)">
        <div class="item-content">
          <div class="item-header">
            <h3 class="item-title">{{ item.vocabularyListName }}</h3>
            <span class="badge" [ngClass]="getStatusBadgeClass(item.status)">
              {{ item.status }}
            </span>
          </div>
          <div class="item-details">
            <div class="detail-item">
              <i class="fas fa-redo text-gray-600"></i>
              <span>ƒê√£ review: {{ item.reviewCount }} l·∫ßn</span>
            </div>
            <div class="detail-item">
              <i class="fas fa-calendar text-gray-600"></i>
              <span>Review l·∫ßn cu·ªëi: {{ formatDate(item.lastReviewedAt) }}</span>
            </div>
            <div class="detail-item" *ngIf="item.nextReviewAt">
              <i class="fas fa-clock text-gray-600"></i>
              <span>Review ti·∫øp: {{ formatDate(item.nextReviewAt) }}</span>
            </div>
            <div class="detail-item">
              <i class="fas fa-calendar-alt text-gray-600"></i>
              <span>Kho·∫£ng c√°ch: {{ item.intervals }} ng√†y</span>
            </div>
          </div>
        </div>
        <div class="item-action">
          <i class="fas fa-arrow-right text-purple-600"></i>
        </div>
      </div>
    </div>
  </div>
</div>

